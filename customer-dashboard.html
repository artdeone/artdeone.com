<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Dashboard - ART de ONE</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/ddkd9lxpr/image/upload/v1769316272/fav-icon_n00lji.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CZRQ0NPPJ2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-CZRQ0NPPJ2');
    </script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --primary-black:#000;--primary-white:#fff;--accent-green:#a7e169;
            --accent-red:#ed2939;--gray-50:#f9f9f9;--gray-200:#e5e5e5;--gray-900:#323232;
            --shadow-xs:0 1px 2px rgba(0,0,0,.04);--shadow-sm:0 2px 8px rgba(0,0,0,.04);
            --ease:cubic-bezier(.4,0,.2,1);--ease-spring:cubic-bezier(.34,1.56,.64,1);
            --radius-sm:10px;--radius-md:16px;--radius-lg:22px;
        }
        body{font-family:'Poppins',sans-serif;background:var(--gray-50);min-height:100vh;color:var(--gray-900);-webkit-font-smoothing:antialiased}
        ::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}
        ::-webkit-scrollbar-thumb{background:var(--gray-200);border-radius:10px}

        /* ========== GRAIN TEXTURE (from index.html) ========== */
        .grain-btn{position:relative;overflow:hidden;isolation:isolate}
        .grain-btn::after{
            content:'';position:absolute;inset:0;z-index:1;pointer-events:none;border-radius:inherit;
            opacity:.07;mix-blend-mode:overlay;
            background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='g'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23g)'/%3E%3C/svg%3E");
            background-size:128px 128px;
        }
        .grain-btn:hover::after{opacity:.10}

        /* ========== TOP NAV ========== */
        .top-nav{background:rgba(255,255,255,.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid rgba(0,0,0,.05);position:sticky;top:0;z-index:100;transition:box-shadow .3s var(--ease)}
        .top-nav.scrolled{box-shadow:0 1px 20px rgba(0,0,0,.06)}
        .nav-container{max-width:1200px;margin:0 auto;padding:0 28px;display:flex;justify-content:space-between;align-items:center;height:60px}
        .nav-logo img{height:30px;display:block;transition:transform .3s var(--ease)}
        .nav-logo img:hover{transform:scale(1.04)}
        .nav-actions{display:flex;gap:8px;align-items:center}
        .btn{padding:9px 20px;border-radius:8px;border:none;cursor:pointer;font-weight:600;font-family:'Poppins',sans-serif;font-size:.82em;transition:all .25s var(--ease);position:relative;overflow:hidden;letter-spacing:.01em}
        .btn:active{transform:scale(.96)}
        .btn-refresh{background:var(--accent-green);color:var(--primary-black);box-shadow:0 2px 8px rgba(167,225,105,.15)}
        .btn-refresh:hover{background:#96d158;transform:translateY(-1px)}
        .btn-logout{background:#fff0f1;color:var(--accent-red);border:1px solid rgba(237,41,57,.06)}
        .btn-logout:hover{background:#ffe4e6}

        /* ========== LOGIN SECTION ========== */
        .login-section{display:flex;min-height:100vh}
        .login-left{flex:1;background:#000;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
        .login-left video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
        .login-right{flex:1;display:flex;align-items:center;justify-content:center;padding:40px;background:var(--primary-white)}
        .login-card{max-width:420px;width:100%;animation:loginCardIn .6s var(--ease) both}
        @keyframes loginCardIn{from{opacity:0;transform:translateY(24px) scale(.97)}to{opacity:1;transform:translateY(0) scale(1)}}
        .login-card .logo-wrap{text-align:center;margin-bottom:28px}
        .login-card .logo-wrap img{height:40px}
        .login-card h2{text-align:center;margin-bottom:10px;font-family:'Space Grotesk',sans-serif;font-size:1.4em;font-weight:700;letter-spacing:-.02em;color:var(--primary-black)}
        .login-card .login-subtitle{text-align:center;color:#999;font-size:.88em;margin-bottom:28px;line-height:1.6}

        /* ‚îÄ‚îÄ Google Button (btn-primary style from hero) ‚îÄ‚îÄ */
        .login-google-btn{
            display:flex;align-items:center;justify-content:center;gap:12px;
            width:100%;padding:15px 24px;
            background:var(--accent-green);border:1px solid var(--accent-green);border-radius:2rem;
            font-family:'Poppins',sans-serif;font-size:.95em;font-weight:600;color:#000;
            cursor:pointer;transition:all .3s ease;
            box-shadow:inset 0 0 12px 3px rgba(255,255,255,.40),inset 0 0 28px 6px rgba(255,255,255,.12),0 0 18px 4px rgba(167,225,105,.12);
        }
        .login-google-btn:hover{
            background:var(--accent-red);border-color:var(--accent-red);color:#fff;transform:translateY(-2px);
            box-shadow:inset 0 0 14px 4px rgba(255,255,255,.45),inset 0 0 32px 8px rgba(255,255,255,.15),0 0 25px 6px rgba(237,41,57,.15);
        }
        .login-google-btn:active{transform:scale(.98) translateY(0)}
        .login-google-btn svg{width:22px;height:22px;flex-shrink:0}
        .login-google-btn .btn-loading{display:none}
        .login-google-btn.loading .btn-text{display:none}
        .login-google-btn.loading .btn-loading{display:flex;align-items:center;gap:8px}

        /* ‚îÄ‚îÄ Sign In Button (dark, inner glow) ‚îÄ‚îÄ */
        .login-signin-btn{
            width:100%;padding:15px 24px;
            background:var(--primary-black);color:var(--primary-white);
            border:1px solid var(--primary-black);border-radius:2rem;
            font-family:'Poppins',sans-serif;font-size:.95em;font-weight:600;
            cursor:pointer;transition:all .3s ease;margin-top:4px;
            box-shadow:inset 0 0 12px 3px rgba(255,255,255,.18),inset 0 0 28px 6px rgba(255,255,255,.06),0 0 18px 4px rgba(0,0,0,.06);
        }
        .login-signin-btn:hover{
            background:var(--accent-green);border-color:var(--accent-green);color:#000;transform:translateY(-2px);
            box-shadow:inset 0 0 14px 4px rgba(255,255,255,.45),inset 0 0 32px 8px rgba(255,255,255,.15),0 0 25px 6px rgba(167,225,105,.18);
        }
        .login-signin-btn:active{transform:scale(.98)}
        .login-signin-btn:disabled{opacity:.6;cursor:not-allowed;transform:none!important}
        .login-signin-btn .btn-loading{display:none}
        .login-signin-btn.loading .btn-text{display:none}
        .login-signin-btn.loading .btn-loading{display:inline-flex;align-items:center;gap:8px}

        /* ‚îÄ‚îÄ Create Account Button (btn-secondary style from hero) ‚îÄ‚îÄ */
        .login-create-btn{
            width:100%;padding:15px 24px;
            background:var(--accent-red);color:#fff;
            border:1px solid var(--accent-red);border-radius:2rem;
            font-family:'Poppins',sans-serif;font-size:.95em;font-weight:600;
            cursor:pointer;transition:all .3s ease;
            box-shadow:inset 0 0 12px 3px rgba(255,255,255,.35),inset 0 0 28px 6px rgba(255,255,255,.10),0 0 18px 4px rgba(237,41,57,.10);
        }
        .login-create-btn:hover{
            background:var(--accent-green);border-color:var(--accent-green);color:#000;transform:translateY(-2px);
            box-shadow:inset 0 0 14px 4px rgba(255,255,255,.45),inset 0 0 32px 8px rgba(255,255,255,.15),0 0 25px 6px rgba(167,225,105,.18);
        }
        .login-create-btn:active{transform:scale(.98)}
        .login-create-btn:disabled{opacity:.6;cursor:not-allowed;transform:none!important}
        .login-create-btn .btn-loading{display:none}
        .login-create-btn.loading .btn-text{display:none}
        .login-create-btn.loading .btn-loading{display:inline-flex;align-items:center;gap:8px}

        /* ‚îÄ‚îÄ Reset / Back Link Button ‚îÄ‚îÄ */
        .login-back-btn{
            width:100%;padding:14px 24px;
            background:transparent;color:#999;
            border:1.5px solid var(--gray-200);border-radius:2rem;
            font-family:'Poppins',sans-serif;font-size:.9em;font-weight:500;
            cursor:pointer;transition:all .3s ease;margin-top:8px;
        }
        .login-back-btn:hover{border-color:var(--accent-green);color:var(--primary-black);transform:translateY(-1px)}

        /* ‚îÄ‚îÄ Auth Form Elements ‚îÄ‚îÄ */
        .login-divider{display:flex;align-items:center;gap:16px;margin:20px 0;color:#ccc;font-size:.78em}
        .login-divider::before,.login-divider::after{content:'';flex:1;height:1px;background:var(--gray-200)}
        .auth-form-group{margin-bottom:12px}
        .auth-input{
            width:100%;padding:14px 16px;border:1.5px solid var(--gray-200);border-radius:12px;
            font-family:'Poppins',sans-serif;font-size:.9em;transition:all .3s var(--ease);
            background:var(--gray-50);color:var(--gray-900);
        }
        .auth-input:hover{border-color:#ccc}
        .auth-input:focus{outline:none;border-color:var(--accent-green);box-shadow:0 0 0 4px rgba(167,225,105,.12);background:var(--primary-white)}
        .auth-input::placeholder{color:#bbb}
        .auth-links{display:flex;justify-content:center;gap:20px;margin-top:16px}
        .auth-link{background:none;border:none;color:#999;font-size:.8em;cursor:pointer;font-family:'Poppins',sans-serif;transition:color .2s;padding:0}
        .auth-link:hover{color:var(--primary-black);text-decoration:underline}
        .password-hint{font-size:.72em;color:#bbb;margin-top:4px;margin-bottom:12px;padding-left:2px}

        /* ‚îÄ‚îÄ Auth States ‚îÄ‚îÄ */
        .login-error{
            color:var(--accent-red);font-size:.82em;text-align:center;margin-top:14px;display:none;
            animation:errorShake .4s var(--ease);background:#fff5f5;padding:10px 16px;border-radius:8px;
            border:1px solid rgba(237,41,57,.08);
        }
        .login-loading-state{text-align:center;padding:40px 20px;display:none}
        .login-loading-state .spinner{width:36px;height:36px;border:3px solid var(--gray-200);border-top-color:var(--accent-green);border-radius:50%;animation:spin .7s linear infinite;margin:0 auto 16px}
        .login-loading-state p{color:#999;font-size:.88em}
        .auth-success-box{text-align:center;padding:24px 0;animation:fadeSlideUp .5s var(--ease) both}
        .auth-success-box .success-icon{font-size:2.8em;margin-bottom:16px;display:block}
        .auth-success-box h3{font-family:'Space Grotesk',sans-serif;font-size:1.1em;font-weight:700;margin-bottom:8px;color:var(--primary-black)}
        .auth-success-box p{color:#999;font-size:.85em;line-height:1.7}

        @keyframes errorShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-3px)}80%{transform:translateX(3px)}}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes fadeSlideUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

        .hidden{display:none!important}
        .container{max-width:1200px;margin:0 auto;padding:32px 28px}

        /* ========== WELCOME HEADER ========== */
        .welcome-header{background:var(--primary-white);padding:32px 34px;border-radius:var(--radius-lg);margin-bottom:36px;border:1px solid rgba(0,0,0,.05);position:relative;overflow:hidden;box-shadow:var(--shadow-sm);animation:fadeSlideUp .5s var(--ease) both}
        .welcome-header::after{content:'';position:absolute;top:0;right:0;width:200px;height:200px;background:radial-gradient(circle at top right,rgba(167,225,105,.08) 0%,transparent 70%);pointer-events:none}
        .welcome-header h1{font-family:'Space Grotesk',sans-serif;font-size:1.55em;font-weight:700;letter-spacing:-.02em;line-height:1.3}
        .welcome-header .email-text{color:#999;font-size:.88em;margin-top:5px;font-weight:400}
        .welcome-avatar{display:flex;align-items:center;gap:16px;margin-bottom:12px}
        .welcome-avatar img{width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid var(--accent-green)}
        .avatar-fallback{width:48px;height:48px;border-radius:50%;background:var(--primary-black);color:var(--accent-green);display:flex;align-items:center;justify-content:center;font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:1.1em;border:2px solid var(--accent-green)}
        .badge{display:inline-flex;align-items:center;gap:5px;background:var(--primary-black);color:var(--primary-white);padding:5px 14px;border-radius:20px;font-size:.7em;font-weight:600;position:absolute;top:28px;right:32px;letter-spacing:.03em;z-index:1}
        .badge::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--accent-green);animation:badgePulse 2s ease-in-out infinite}
        @keyframes badgePulse{0%,100%{opacity:.5;transform:scale(.9)}50%{opacity:1;transform:scale(1.1)}}

        /* ========== THANK YOU LETTER ========== */
        .thank-you-letter{background:var(--primary-white);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-lg);padding:28px 34px;margin-bottom:36px;position:relative;overflow:hidden;box-shadow:var(--shadow-sm);animation:fadeSlideUp .5s var(--ease) .08s both}
        .thank-you-letter::before{content:'';position:absolute;bottom:0;left:0;width:100%;height:3px;background:linear-gradient(90deg,var(--accent-green),var(--accent-red),var(--accent-green));opacity:.5}
        .thank-you-letter .letter-icon{font-size:1.6em;margin-bottom:10px}
        .thank-you-letter p{font-size:.88em;line-height:1.9;color:#555}
        .thank-you-letter p strong{color:var(--primary-black)}

        .section-title{font-family:'Space Grotesk',sans-serif;font-size:1.2em;font-weight:700;margin-bottom:22px;letter-spacing:-.01em;color:var(--primary-black);animation:fadeSlideUp .5s var(--ease) .1s both}

        /* ========== PRODUCTS ========== */
        .product-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;animation:fadeSlideUp .5s var(--ease) .15s both}
        .product-card{background:var(--primary-white);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-md);overflow:hidden;transition:all .35s var(--ease);box-shadow:var(--shadow-xs);opacity:0;animation:cardStagger .5s var(--ease) both}
        .product-card:nth-child(1){animation-delay:.08s}.product-card:nth-child(2){animation-delay:.14s}.product-card:nth-child(3){animation-delay:.20s}
        .product-card:nth-child(4){animation-delay:.26s}.product-card:nth-child(5){animation-delay:.32s}.product-card:nth-child(6){animation-delay:.38s}
        @keyframes cardStagger{from{opacity:0;transform:translateY(16px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}
        .product-card:hover{transform:translateY(-6px);box-shadow:0 12px 36px rgba(167,225,105,.18),0 4px 12px rgba(0,0,0,.04);border-color:rgba(167,225,105,.2)}
        .product-card .thumb-wrapper{position:relative;overflow:hidden;background:var(--gray-50)}
        .product-card .thumb{width:100%;aspect-ratio:16/10;object-fit:cover;display:block;background:var(--gray-50);transition:transform .5s var(--ease)}
        .product-card:hover .thumb{transform:scale(1.04)}
        .product-card .card-body{padding:20px 22px 22px}
        .product-card .product-name{font-family:'Space Grotesk',sans-serif;font-weight:600;font-size:1.02em;margin-bottom:10px;line-height:1.35;letter-spacing:-.01em}
        .category-badge{display:inline-flex;align-items:center;background:rgba(167,225,105,.12);color:#4a7c1a;padding:4px 12px;border-radius:20px;font-size:.72em;font-weight:600;margin-bottom:16px;letter-spacing:.02em}
        .btn-download{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;text-align:center;padding:11px 20px;border-radius:50px;background:var(--accent-green);color:var(--primary-black);font-weight:600;font-size:.85em;text-decoration:none;font-family:'Poppins',sans-serif;transition:all .3s var(--ease);border:none;cursor:pointer;box-shadow:0 2px 8px rgba(167,225,105,.15);position:relative;overflow:hidden}
        .btn-download::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transform:translateX(-100%);transition:transform .5s var(--ease)}
        .btn-download:hover::before{transform:translateX(100%)}
        .btn-download:hover{background:var(--accent-red);color:var(--primary-white);box-shadow:0 4px 16px rgba(237,41,57,.2);transform:translateY(-1px)}
        .btn-download:active{transform:scale(.97) translateY(0)}
        .btn-download svg{width:16px;height:16px;flex-shrink:0}

        .empty-state{text-align:center;padding:70px 24px;background:var(--primary-white);border-radius:var(--radius-lg);border:1px solid rgba(0,0,0,.05);box-shadow:var(--shadow-sm);animation:fadeSlideUp .5s var(--ease) .15s both}
        .empty-state .icon{font-size:3.2em;margin-bottom:18px;opacity:.25;display:block;animation:emptyFloat 3s ease-in-out infinite}
        @keyframes emptyFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
        .empty-state p{color:#aaa;font-size:.92em;line-height:1.8;max-width:320px;margin:0 auto}
        .loading-spinner{text-align:center;padding:50px;color:#bbb;font-size:.9em;animation:fadeSlideUp .4s var(--ease) both}
        .loading-spinner::before{content:'';display:block;width:28px;height:28px;margin:0 auto 14px;border:2.5px solid var(--gray-200);border-top-color:var(--accent-green);border-radius:50%;animation:spin .7s linear infinite}

        .dashboard-enter{animation:dashboardFadeIn .5s var(--ease) both}
        @keyframes dashboardFadeIn{from{opacity:0}to{opacity:1}}
        *:focus-visible{outline:2px solid var(--accent-green);outline-offset:2px}

        /* ========== CART ========== */
        .btn-cart{background:var(--primary-white);color:var(--gray-900);border:1px solid var(--gray-200);position:relative;padding:9px 14px}
        .btn-cart:hover{background:var(--gray-50);border-color:var(--accent-green)}
        .btn-cart i{font-size:1em}
        .cart-count{position:absolute;top:-4px;right:-4px;background:var(--accent-red);color:#fff;font-size:.6em;font-weight:700;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;animation:cartPop .3s var(--ease-spring)}
        .cart-count.hidden-count{display:none}
        @keyframes cartPop{from{transform:scale(0)}to{transform:scale(1)}}
        .cart-overlay{position:fixed;inset:0;background:rgba(0,0,0,0);z-index:199;pointer-events:none;transition:background .35s var(--ease)}
        .cart-overlay.active{background:rgba(0,0,0,.35);pointer-events:auto;backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px)}
        .cart-slidein{position:fixed;top:0;right:0;bottom:0;width:380px;max-width:90vw;background:var(--primary-white);z-index:200;box-shadow:-8px 0 40px rgba(0,0,0,.1);display:flex;flex-direction:column;transform:translateX(100%);transition:transform .4s var(--ease)}
        .cart-slidein.active{transform:translateX(0)}
        .cart-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid rgba(0,0,0,.06);flex-shrink:0}
        .cart-header h3{font-family:'Space Grotesk',sans-serif;font-size:1.15em;font-weight:700}
        .cart-header button{background:none;border:none;font-size:1.2em;cursor:pointer;color:#999;padding:4px;transition:color .2s}
        .cart-header button:hover{color:#333}
        .cart-items{flex:1;overflow-y:auto;padding:16px 24px}
        .cart-item{display:flex;align-items:center;gap:14px;padding:14px 0;border-bottom:1px solid rgba(0,0,0,.04);animation:fadeSlideUp .3s var(--ease) both}
        .cart-item:last-child{border-bottom:none}
        .cart-item-img{width:60px;height:45px;object-fit:cover;border-radius:8px;background:var(--gray-50);flex-shrink:0}
        .cart-item-info{flex:1;min-width:0}
        .cart-item-name{font-family:'Space Grotesk',sans-serif;font-size:.88em;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .cart-item-price{font-family:'Space Grotesk',sans-serif;font-size:.78em;color:#999;font-weight:500}
        .cart-item-remove{background:#fef2f2;border:none;color:#991b1b;width:28px;height:28px;border-radius:50%;cursor:pointer;font-size:.7em;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
        .cart-item-remove:hover{background:#fee2e2;transform:scale(1.1)}
        .cart-empty{text-align:center;padding:40px 0;color:#ccc}
        .cart-empty i{font-size:2em;margin-bottom:12px;display:block;opacity:.4}
        .cart-footer{padding:20px 24px;border-top:1px solid rgba(0,0,0,.06);flex-shrink:0}
        .cart-total{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;font-family:'Space Grotesk',sans-serif}
        .cart-total-label{font-size:.85em;color:#999;font-weight:500}
        .cart-total-value{font-size:1.2em;font-weight:700;color:var(--primary-black)}
        .cart-footer .btn{width:100%;padding:13px;border-radius:12px;font-size:.92em;margin-bottom:8px}
        .btn-order{background:var(--accent-green);color:var(--primary-black);box-shadow:0 2px 10px rgba(167,225,105,.2)}
        .btn-order:hover{background:#96d158;box-shadow:0 4px 18px rgba(167,225,105,.3)}
        .btn-cancel-cart{background:var(--gray-50);color:#999;border:1px solid var(--gray-200)}
        .btn-cancel-cart:hover{background:var(--gray-200);color:#555}

        /* ========== PROFILE ========== */
        .btn-profile{background:var(--primary-white);color:var(--gray-900);border:1px solid var(--gray-200);padding:9px 14px;display:flex;align-items:center;gap:6px}
        .btn-profile:hover{background:var(--gray-50);border-color:var(--accent-green)}
        .btn-profile .profile-avatar-sm{width:22px;height:22px;border-radius:50%;background:var(--primary-black);color:var(--accent-green);display:flex;align-items:center;justify-content:center;font-size:.65em;font-weight:700;font-family:'Space Grotesk',sans-serif;overflow:hidden}
        .btn-profile .profile-avatar-sm img{width:100%;height:100%;object-fit:cover}
        .profile-overlay{position:fixed;inset:0;background:rgba(0,0,0,0);z-index:199;pointer-events:none;transition:background .35s var(--ease)}
        .profile-overlay.active{background:rgba(0,0,0,.35);pointer-events:auto;backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px)}
        .profile-slidein{position:fixed;top:0;right:0;bottom:0;width:400px;max-width:90vw;background:var(--primary-white);z-index:200;box-shadow:-8px 0 40px rgba(0,0,0,.1);display:flex;flex-direction:column;transform:translateX(100%);transition:transform .4s var(--ease)}
        .profile-slidein.active{transform:translateX(0)}
        .profile-header{padding:28px 28px 0;flex-shrink:0}
        .profile-header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
        .profile-header-top h3{font-family:'Space Grotesk',sans-serif;font-size:1.15em;font-weight:700;display:flex;align-items:center;gap:8px}
        .profile-header-top button{background:none;border:none;font-size:1.2em;cursor:pointer;color:#999;padding:4px;transition:color .2s}
        .profile-header-top button:hover{color:#333}
        .profile-avatar-wrap{text-align:center;margin-bottom:24px}
        .profile-avatar{width:72px;height:72px;border-radius:50%;background:var(--primary-black);color:var(--accent-green);display:flex;align-items:center;justify-content:center;font-size:1.6em;font-weight:700;font-family:'Space Grotesk',sans-serif;margin:0 auto 12px;box-shadow:0 4px 16px rgba(0,0,0,.12);overflow:hidden}
        .profile-avatar img{width:100%;height:100%;object-fit:cover}
        .profile-avatar-wrap .profile-name{font-family:'Space Grotesk',sans-serif;font-size:1.15em;font-weight:700;margin-bottom:4px}
        .profile-avatar-wrap .profile-status{display:inline-flex;align-items:center;gap:5px;font-size:.72em;font-weight:600;color:#16a34a;background:#f0fdf4;padding:3px 12px;border-radius:20px}
        .profile-avatar-wrap .profile-status::before{content:'';width:6px;height:6px;border-radius:50%;background:#16a34a}
        .profile-content{flex:1;overflow-y:auto;padding:0 28px 28px}
        .profile-info-section{margin-bottom:24px}
        .profile-info-label{font-size:.7em;font-weight:600;color:#999;text-transform:uppercase;letter-spacing:.06em;margin-bottom:14px}
        .profile-info-card{background:var(--gray-50);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-sm);overflow:hidden}
        .profile-info-row{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid rgba(0,0,0,.04)}
        .profile-info-row:last-child{border-bottom:none}
        .profile-info-row .info-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.85em;flex-shrink:0}
        .profile-info-row .info-icon.email-icon{background:#eff6ff;color:#2563eb}
        .profile-info-row .info-icon.phone-icon{background:#f0fdf4;color:#16a34a}
        .profile-info-row .info-icon.date-icon{background:#fefce8;color:#ca8a04}
        .profile-info-row .info-icon.method-icon{background:#fef2f2;color:#dc2626}
        .profile-info-row .info-detail{flex:1;min-width:0}
        .profile-info-row .info-detail .info-title{font-size:.72em;color:#999;font-weight:500;margin-bottom:2px}
        .profile-info-row .info-detail .info-value{font-size:.88em;font-weight:600;color:var(--gray-900);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .profile-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:24px}
        .profile-stat-card{background:var(--gray-50);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-sm);padding:16px;text-align:center}
        .profile-stat-card .stat-value{font-family:'Space Grotesk',sans-serif;font-size:1.5em;font-weight:700;color:var(--primary-black);margin-bottom:2px}
        .profile-stat-card .stat-label{font-size:.72em;color:#999;font-weight:500}
        .profile-orders-section{margin-bottom:12px}
        .profile-order-item{display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--gray-50);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-sm);margin-bottom:8px;transition:all .2s var(--ease)}
        .profile-order-item:hover{background:#f0fdf4;border-color:var(--accent-green)}
        .profile-order-item .order-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.8em;flex-shrink:0}
        .profile-order-item .order-icon.pending{background:#fefce8;color:#ca8a04}
        .profile-order-item .order-icon.confirmed{background:#f0fdf4;color:#16a34a}
        .profile-order-item .order-icon.delivered{background:#eff6ff;color:#2563eb}
        .profile-order-item .order-icon.cancelled{background:#fef2f2;color:#dc2626}
        .profile-order-item .order-detail{flex:1;min-width:0}
        .profile-order-item .order-name{font-size:.85em;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .profile-order-item .order-meta{font-size:.72em;color:#999;margin-top:2px}
        .profile-order-item .order-status-badge{font-size:.65em;font-weight:700;padding:3px 10px;border-radius:20px;text-transform:uppercase;letter-spacing:.03em;flex-shrink:0}
        .profile-order-item .order-status-badge.pending{background:#fefce8;color:#a16207}
        .profile-order-item .order-status-badge.confirmed{background:#f0fdf4;color:#15803d}
        .profile-order-item .order-status-badge.delivered{background:#eff6ff;color:#1d4ed8}
        .profile-order-item .order-status-badge.cancelled{background:#fef2f2;color:#b91c1c}
        .profile-orders-empty{text-align:center;padding:28px 0;color:#ccc;font-size:.85em}
        .profile-orders-empty i{display:block;font-size:1.5em;margin-bottom:8px;opacity:.4}

        /* ========== BROWSE ========== */
        .browse-section{margin-top:48px;animation:fadeSlideUp .5s var(--ease) .2s both}
        .browse-section .section-title{display:flex;align-items:center;gap:10px}
        .browse-section .section-title i{color:var(--accent-red);font-size:.85em}
        .browse-card .card-body{display:flex;flex-direction:column}
        .browse-price{font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:1.1em;color:var(--primary-black);margin-bottom:12px}
        .browse-price span{font-size:.7em;font-weight:400;color:#999}
        .btn-buy{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:11px 20px;border-radius:50px;background:var(--accent-red);color:var(--primary-white);font-weight:600;font-size:.85em;font-family:'Poppins',sans-serif;transition:all .3s var(--ease);border:none;cursor:pointer;box-shadow:0 2px 10px rgba(237,41,57,.15)}
        .btn-buy:hover{background:var(--accent-green);color:var(--primary-black);box-shadow:0 4px 16px rgba(167,225,105,.3);transform:translateY(-1px)}
        .btn-buy:active{transform:scale(.97)}.btn-buy.added{background:#e5e5e5;color:#999;box-shadow:none;pointer-events:none}
        .course-card-badge{position:absolute;top:10px;left:10px;background:var(--accent-red);color:#fff;font-size:.62em;font-weight:700;padding:3px 10px;border-radius:2rem;letter-spacing:.04em;text-transform:uppercase;z-index:2}
        .toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--primary-black);color:#fff;padding:14px 28px;border-radius:12px;font-size:.88em;font-weight:500;box-shadow:0 8px 30px rgba(0,0,0,.2);z-index:500;transition:transform .4s var(--ease-spring);display:flex;align-items:center;gap:10px}
        .toast.show{transform:translateX(-50%) translateY(0)}.toast i{color:var(--accent-green)}

        /* ========== COURSE PLAYER ========== */
        .course-player-wrap{max-width:900px;margin:0 auto}
        .back-btn{background:none;border:none;color:#666;cursor:pointer;font-size:.9em;margin-bottom:16px;display:flex;align-items:center;gap:6px;font-family:'Poppins',sans-serif;padding:0;transition:color .2s}
        .back-btn:hover{color:var(--primary-black)}
        .video-container{background:#000;border-radius:var(--radius-md);overflow:hidden;aspect-ratio:16/9;margin-bottom:20px}
        .video-container iframe{width:100%;height:100%;border:none}
        .materials-section{background:var(--primary-white);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-md);padding:20px 24px;margin-bottom:20px}
        .materials-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
        .materials-header h3{margin:0;font-size:1em;display:flex;align-items:center;gap:8px;font-family:'Space Grotesk',sans-serif}
        .mat-count-badge{background:#e0f2fe;color:#0284c7;font-size:.72em;padding:2px 8px;border-radius:10px;font-weight:600}
        .download-all-btn{background:var(--primary-black);color:var(--accent-green);border:none;padding:7px 16px;border-radius:8px;font-size:.78em;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px;font-family:'Poppins',sans-serif;transition:all .2s var(--ease)}
        .download-all-btn:hover{background:#065f46;transform:scale(1.03)}
        .material-download-card{display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--gray-50);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-sm);margin-bottom:8px;transition:all .2s var(--ease)}
        .material-download-card:hover{background:#f0fdf4;border-color:var(--accent-green);transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.04)}
        .mat-icon{width:44px;height:44px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;flex-shrink:0}
        .mat-icon.pdf{background:#fef2f2;color:#dc2626}.mat-icon.zip{background:#fefce8;color:#ca8a04}.mat-icon.doc{background:#eff6ff;color:#2563eb}.mat-icon.xls{background:#f0fdf4;color:#16a34a}.mat-icon.ppt{background:#fdf4ff;color:#c026d3}.mat-icon.png,.mat-icon.jpg{background:#ecfeff;color:#0891b2}.mat-icon.mp3{background:#fdf2f8;color:#db2777}.mat-icon.mp4{background:#fff7ed;color:#ea580c}.mat-icon.code{background:#f5f3ff;color:#7c3aed}.mat-icon.other{background:#f3f4f6;color:#6b7280}
        .mat-icon svg{width:20px;height:20px}
        .mat-details{flex:1;min-width:0}.mat-details .mat-name{font-weight:600;font-size:.88em;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-details .mat-meta{font-size:.72em;color:#999;margin-top:2px}
        .mat-download-btn{background:var(--primary-black);color:#fff;border:none;padding:8px 16px;border-radius:8px;font-size:.78em;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all .2s var(--ease);flex-shrink:0;font-family:'Poppins',sans-serif}
        .mat-download-btn:hover{background:#065f46;color:var(--accent-green);transform:scale(1.03)}
        .lessons-sidebar{background:var(--primary-white);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-md);padding:20px 24px}
        .lessons-sidebar h3{margin:0 0 14px;font-size:1em;font-family:'Space Grotesk',sans-serif;display:flex;align-items:center;gap:8px}
        .lesson-list-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:var(--radius-sm);cursor:pointer;transition:all .2s var(--ease);margin-bottom:4px;border:1px solid transparent}
        .lesson-list-item:hover{background:#f3f4f6}.lesson-list-item.active{background:#f0fdf4;border-color:var(--accent-green)}
        .lesson-idx{width:30px;height:30px;border-radius:8px;background:var(--gray-200);display:flex;align-items:center;justify-content:center;font-family:'Space Grotesk',monospace;font-weight:700;font-size:.8em;flex-shrink:0}
        .lesson-list-item.active .lesson-idx{background:var(--primary-black);color:var(--accent-green)}
        .lesson-title-text{flex:1;font-size:.86em;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .lesson-duration{font-size:.72em;color:#999;flex-shrink:0}
        .lesson-mat-badge{background:#dbeafe;color:#1d4ed8;font-size:.68em;padding:2px 7px;border-radius:6px;flex-shrink:0;font-weight:600;display:inline-flex;align-items:center;gap:3px}

        /* ========== RESPONSIVE ========== */
        @media(max-width:992px){.product-grid{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:600px){
            .product-grid{grid-template-columns:1fr;gap:16px}
            .nav-container{padding:0 16px;height:54px}.nav-logo img{height:26px}
            .btn{padding:8px 14px;font-size:.78em}.container{padding:20px 16px}
            .welcome-header{padding:24px 22px;border-radius:var(--radius-md)}.welcome-header h1{font-size:1.2em}
            .welcome-header .email-text{font-size:.82em}.badge{position:static;margin-top:12px;display:inline-flex}
            .section-title{font-size:1.08em;margin-bottom:18px}
            .product-card .card-body{padding:16px 18px 18px}.product-card .product-name{font-size:.95em}
            .login-section{flex-direction:column}.login-left{flex:none;height:35vh;min-height:200px}
            .login-right{flex:1;padding:32px 24px}.login-card{max-width:100%}.login-card h2{font-size:1.25em}
            .empty-state{padding:50px 20px}
            .thank-you-letter{padding:22px 20px;border-radius:var(--radius-md)}.thank-you-letter p{font-size:.84em}
            .profile-slidein{width:100%;max-width:100%}.cart-slidein{width:100%;max-width:100%}
            .btn-profile span{display:none}.btn-profile{padding:9px 12px}
            .material-download-card{flex-wrap:wrap}.mat-download-btn{width:100%;justify-content:center}
        }
        @media(max-width:380px){.nav-actions{gap:5px}.btn{padding:7px 12px;font-size:.75em}}
        @media(hover:none){.product-card:hover{transform:none;box-shadow:var(--shadow-xs);border-color:rgba(0,0,0,.05)}.product-card:hover .thumb{transform:none}.btn-download:hover{transform:none}}
    </style>
</head>
<body>

    <!-- ========== LOGIN SECTION ========== -->
    <div id="loginSection" class="login-section">
        <div class="login-left">
            <video autoplay muted loop playsinline>
                <source src="https://res.cloudinary.com/ddkd9lxpr/video/upload/v1771041087/thank-you_olmg32.mp4" type="video/mp4">
            </video>
        </div>
        <div class="login-right">
            <div class="login-card" id="loginCard">
                <div class="logo-wrap">
                    <img src="https://res.cloudinary.com/ddkd9lxpr/image/upload/v1768125759/logo-green_wzaqzh.png" alt="ART de ONE">
                </div>
                <h2>Customer Dashboard</h2>
                <p class="login-subtitle">Login ·ÅÄ·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏ Products ·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äõ·Äö·Ä∞·Äï·Ä´</p>

                <!-- ===== LOGIN FORM ===== -->
                <div id="loginFormView">
                    <button onclick="loginWithGoogle()" class="login-google-btn grain-btn" id="googleBtn">
                        <svg viewBox="0 0 24 24" width="22" height="22"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                        <span class="btn-text">Sign in with Google</span>
                        <span class="btn-loading"><i class="fas fa-spinner fa-spin"></i> Connecting...</span>
                    </button>

                    <div class="login-divider">or</div>

                    <div class="auth-form-group">
                        <input type="email" id="loginEmail" class="auth-input" placeholder="Email">
                    </div>
                    <div class="auth-form-group">
                        <input type="password" id="loginPassword" class="auth-input" placeholder="Password">
                    </div>
                    <button onclick="loginWithEmail()" class="login-signin-btn grain-btn" id="emailLoginBtn">
                        <span class="btn-text">Sign In</span>
                        <span class="btn-loading"><i class="fas fa-spinner fa-spin"></i> Signing in...</span>
                    </button>
                    <div class="auth-links">
                        <button onclick="showForgotPassword()" class="auth-link">Forgot password?</button>
                        <button onclick="showRegister()" class="auth-link">Create account</button>
                    </div>
                </div>

                <!-- ===== REGISTER FORM ===== -->
                <div id="registerFormView" style="display:none;">
                    <div class="auth-form-group">
                        <input type="text" id="regName" class="auth-input" placeholder="Full Name">
                    </div>
                    <div class="auth-form-group">
                        <input type="email" id="regEmail" class="auth-input" placeholder="Email">
                    </div>
                    <div class="auth-form-group">
                        <input type="password" id="regPassword" class="auth-input" placeholder="Password">
                    </div>
                    <p class="password-hint"><i class="fas fa-info-circle"></i> Password ·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ ·ÅÜ ·Äú·ÄØ·Ä∂·Ä∏ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´</p>
                    <button onclick="registerWithEmail()" class="login-create-btn grain-btn" id="emailRegBtn">
                        <span class="btn-text">Create Account</span>
                        <span class="btn-loading"><i class="fas fa-spinner fa-spin"></i> Creating...</span>
                    </button>
                    <div style="margin-top:10px;">
                        <button onclick="showLogin()" class="login-back-btn">Back to Login</button>
                    </div>
                </div>

                <!-- ===== FORGOT PASSWORD ===== -->
                <div id="forgotPasswordView" style="display:none;">
                    <p style="text-align:center;color:#777;font-size:.85em;margin-bottom:16px;line-height:1.6;">Email ·Äë·Ää·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏ Password Reset Link ·Äõ·Äö·Ä∞·Äï·Ä´</p>
                    <div class="auth-form-group">
                        <input type="email" id="resetEmail" class="auth-input" placeholder="Email">
                    </div>
                    <button onclick="sendResetLink()" class="login-signin-btn grain-btn" id="resetBtn">
                        <span class="btn-text">Send Reset Link</span>
                        <span class="btn-loading"><i class="fas fa-spinner fa-spin"></i> Sending...</span>
                    </button>
                    <div style="margin-top:10px;">
                        <button onclick="showLogin()" class="login-back-btn">Back to Login</button>
                    </div>
                </div>

                <!-- ===== SUCCESS ===== -->
                <div id="authSuccessView" style="display:none;">
                    <div class="auth-success-box">
                        <span class="success-icon">‚úâÔ∏è</span>
                        <h3 id="authSuccessTitle">Email ·Äï·Ä≠·ÄØ·Ä∑·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ!</h3>
                        <p id="authSuccessText"></p>
                    </div>
                    <button onclick="showLogin()" class="login-back-btn">Back to Login</button>
                </div>

                <p class="login-error" id="loginError">Login ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åã</p>

                <div class="login-loading-state" id="loginLoading">
                    <div class="spinner"></div>
                    <p>Verifying your account...</p>
                </div>

                <div style="margin-top:24px;padding-top:20px;border-top:1px solid #f0f0f0;text-align:center;font-size:.78em;color:#999;line-height:1.8;">
                    Contact : <a href="mailto:artdeone.educators@gmail.com" style="color:#323232;font-weight:600;text-decoration:none;">artdeone.educators@gmail.com</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== DASHBOARD ========== -->
    <div id="dashboardSection" class="hidden">
        <nav class="top-nav" id="topNav">
            <div class="nav-container">
                <div class="nav-logo"><img src="https://res.cloudinary.com/ddkd9lxpr/image/upload/v1768125759/logo-green_wzaqzh.png" alt="ART de ONE"></div>
                <div class="nav-actions">
                    <button onclick="toggleProfile()" class="btn btn-profile" id="profileBtn"><span class="profile-avatar-sm" id="navAvatarInitial"></span><span>Profile</span></button>
                    <button onclick="toggleCart()" class="btn btn-cart" id="cartBtn"><i class="fas fa-shopping-bag"></i><span class="cart-count hidden-count" id="cartCount">0</span></button>
                    <button onclick="refreshDashboard()" class="btn btn-refresh">Refresh</button>
                    <button onclick="logout()" class="btn btn-logout">Logout</button>
                </div>
            </div>
        </nav>
        <div class="container">
            <div class="welcome-header">
                <span class="badge">Shop Customer</span>
                <div class="welcome-avatar" id="welcomeAvatarWrap"></div>
                <h1 id="customerName">Welcome</h1>
                <p class="email-text" id="customerEmail"></p>
            </div>
            <div class="thank-you-letter" id="thankYouLetter">
                <div class="letter-icon">üíå</div>
                <p id="thankYouText"></p>
            </div>
            <div id="myProductsSection">
                <h2 class="section-title">My Products</h2>
                <div id="productsContainer"><div class="loading-spinner">Loading...</div></div>
                <div class="browse-section" id="browseSection" style="display:none;">
                    <h2 class="section-title"><i class="fas fa-fire"></i> Browse More Products</h2>
                    <div id="browseContainer"></div>
                </div>
            </div>
            <div id="coursePlayerSection" class="hidden">
                <div class="course-player-wrap">
                    <button onclick="backToCourses()" class="back-btn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back to My Products</button>
                    <div class="video-container" id="videoContainer"><iframe id="courseVideoPlayer" allowfullscreen></iframe></div>
                    <div style="background:var(--primary-white);padding:22px 26px;border-radius:var(--radius-md);margin-bottom:20px;border:1px solid rgba(0,0,0,.05);box-shadow:var(--shadow-xs);">
                        <h2 id="currentLessonTitle" style="margin:0 0 4px;font-size:1.15em;font-family:'Space Grotesk',sans-serif;"></h2>
                        <p id="currentLessonDesc" style="margin:0;color:#666;font-size:.88em;line-height:1.6;"></p>
                    </div>
                    <div id="lessonMaterialsSection" class="materials-section" style="display:none;">
                        <div class="materials-header"><h3><i class="fas fa-paperclip" style="font-size:.85em;"></i> Lesson Materials <span id="materialCount" class="mat-count-badge"></span></h3><button onclick="downloadAllMaterials()" id="downloadAllBtn" class="download-all-btn"><i class="fas fa-download" style="font-size:.85em;"></i> Download All</button></div>
                        <div id="materialsList"></div>
                    </div>
                    <div class="lessons-sidebar"><h3><i class="fas fa-book-open" style="font-size:.85em;"></i> All Lessons</h3><div id="lessonsList"></div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart -->
    <div class="cart-overlay" id="cartOverlay" onclick="closeCart()"></div>
    <div class="cart-slidein" id="cartSlidein">
        <div class="cart-header"><h3><i class="fas fa-shopping-bag" style="margin-right:8px;color:var(--accent-red);"></i>Cart</h3><button onclick="closeCart()">‚úï</button></div>
        <div class="cart-items" id="cartItems"><div class="cart-empty"><i class="fas fa-shopping-bag"></i><p style="font-size:.85em;">Your cart is empty</p></div></div>
        <div class="cart-footer">
            <div class="cart-total"><span class="cart-total-label">Total</span><span class="cart-total-value" id="cartTotal">0 MMK</span></div>
            <button onclick="placeOrder()" class="btn btn-order" id="orderBtn"><i class="fas fa-paper-plane" style="margin-right:6px;"></i>Order</button>
            <button onclick="closeCart()" class="btn btn-cancel-cart">Cancel</button>
        </div>
    </div>

    <!-- Profile -->
    <div class="profile-overlay" id="profileOverlay" onclick="closeProfile()"></div>
    <div class="profile-slidein" id="profileSlidein">
        <div class="profile-header">
            <div class="profile-header-top"><h3><i class="fas fa-user-circle" style="color:var(--accent-green);"></i> My Profile</h3><button onclick="closeProfile()">‚úï</button></div>
            <div class="profile-avatar-wrap"><div class="profile-avatar" id="profileAvatar"></div><div class="profile-name" id="profileName"></div><span class="profile-status">Active</span></div>
        </div>
        <div class="profile-content">
            <div class="profile-stats" id="profileStats">
                <div class="profile-stat-card"><div class="stat-value" id="statProducts">0</div><div class="stat-label">Products</div></div>
                <div class="profile-stat-card"><div class="stat-value" id="statOrders">0</div><div class="stat-label">Orders</div></div>
            </div>
            <div class="profile-info-section">
                <div class="profile-info-label">Account Information</div>
                <div class="profile-info-card">
                    <div class="profile-info-row"><div class="info-icon email-icon"><i class="fas fa-envelope"></i></div><div class="info-detail"><div class="info-title">Email</div><div class="info-value" id="profileEmail">-</div></div></div>
                    <div class="profile-info-row"><div class="info-icon phone-icon"><i class="fas fa-phone"></i></div><div class="info-detail"><div class="info-title">Phone</div><div class="info-value" id="profilePhone">-</div></div></div>
                    <div class="profile-info-row"><div class="info-icon date-icon"><i class="fas fa-calendar-alt"></i></div><div class="info-detail"><div class="info-title">Member Since</div><div class="info-value" id="profileDate">-</div></div></div>
                    <div class="profile-info-row"><div class="info-icon method-icon" id="loginMethodIcon"><i class="fab fa-google"></i></div><div class="info-detail"><div class="info-title">Login Method</div><div class="info-value" id="loginMethodValue">Google Account</div></div></div>
                </div>
            </div>
            <div class="profile-orders-section"><div class="profile-info-label">Order History</div><div id="profileOrdersList"><div class="profile-orders-empty"><i class="fas fa-receipt"></i><p>No orders yet</p></div></div></div>
        </div>
    </div>

    <div class="toast" id="toast"><i class="fas fa-check-circle"></i><span id="toastMsg">Done!</span></div>

    <!-- ========== SCRIPT ========== -->
    <script type="module">
    import { supabaseShop, PRODUCT_CATEGORIES, signInWithGoogle, signOutCustomer, getAuthSession, onAuthChange, findOrCreateCustomer, signUpWithEmail, signInWithEmail, resetPassword } from './js/config-shop.js';

    let currentCustomer = null, allProducts = [], purchasedProductIds = [], cart = [];
    const FILE_SVG = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Z"/><path d="M14 2v6h6"/></svg>`;

    window.addEventListener('scroll', () => { const n = document.getElementById('topNav'); if (n) n.classList.toggle('scrolled', window.scrollY > 8); }, { passive: true });

    // ========== VIEW TOGGLES ==========
    function hideAllAuthViews() {
        ['loginFormView','registerFormView','forgotPasswordView','authSuccessView'].forEach(id => { const e = document.getElementById(id); if (e) e.style.display = 'none'; });
        document.getElementById('loginError').style.display = 'none';
    }
    window.showLogin = () => { hideAllAuthViews(); document.getElementById('loginFormView').style.display = 'block'; document.querySelector('.login-card h2').textContent = 'Customer Dashboard'; document.querySelector('.login-subtitle').textContent = 'Login ·ÅÄ·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏ Products ·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äõ·Äö·Ä∞·Äï·Ä´'; };
    window.showRegister = () => { hideAllAuthViews(); document.getElementById('registerFormView').style.display = 'block'; document.querySelector('.login-card h2').textContent = 'Create Account'; document.querySelector('.login-subtitle').textContent = '·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Ä°·Äû·ÄÖ·Ä∫ ·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äï·Ä´'; };
    window.showForgotPassword = () => { hideAllAuthViews(); document.getElementById('forgotPasswordView').style.display = 'block'; document.querySelector('.login-card h2').textContent = 'Reset Password'; document.querySelector('.login-subtitle').textContent = 'Password ·Äô·Ä±·Ä∑·Äî·Ä±·Äï·Ä´·Äû·Äú·Ä¨·Ä∏?'; };
    function showAuthSuccess(t, m) { hideAllAuthViews(); document.getElementById('authSuccessView').style.display = 'block'; document.getElementById('authSuccessTitle').textContent = t; document.getElementById('authSuccessText').textContent = m; document.querySelector('.login-card h2').textContent = t; document.querySelector('.login-subtitle').textContent = ''; }

    // ========== EMAIL AUTH ==========
    window.loginWithEmail = async () => {
        const email = document.getElementById('loginEmail').value.trim(), password = document.getElementById('loginPassword').value;
        const btn = document.getElementById('emailLoginBtn'), err = document.getElementById('loginError');
        if (!email || !password) { err.textContent = 'Email ·Äî·Äæ·ÄÑ·Ä∑·Ä∫ Password ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´'; err.style.display = 'block'; return; }
        btn.classList.add('loading'); btn.disabled = true; err.style.display = 'none';
        const { data, error } = await signInWithEmail(email, password);
        btn.classList.remove('loading'); btn.disabled = false;
        if (error) {
            err.textContent = error.message.includes('Invalid login') ? 'Email ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ Password ·Äô·Äæ·Ä¨·Ä∏·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫' : error.message.includes('Email not confirmed') ? 'Email ·ÄÄ·Ä≠·ÄØ ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äï·Ä±·Ä∏·Äï·Ä´·Åã Inbox ·ÄÖ·ÄÖ·Ä∫·Äï·Ä´·Åã' : error.message;
            err.style.display = 'block'; err.style.animation = 'none'; err.offsetHeight; err.style.animation = 'errorShake .4s var(--ease)'; return;
        }
        showLoginLoading();
    };

    window.registerWithEmail = async () => {
        const name = document.getElementById('regName').value.trim(), email = document.getElementById('regEmail').value.trim(), password = document.getElementById('regPassword').value;
        const btn = document.getElementById('emailRegBtn'), err = document.getElementById('loginError');
        if (!name || !email || !password) { err.textContent = '·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´'; err.style.display = 'block'; return; }
        if (password.length < 6) { err.textContent = 'Password ·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ ·ÅÜ ·Äú·ÄØ·Ä∂·Ä∏ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´'; err.style.display = 'block'; return; }
        btn.classList.add('loading'); btn.disabled = true; err.style.display = 'none';
        const { data, error } = await signUpWithEmail(email, password, name);
        btn.classList.remove('loading'); btn.disabled = false;
        if (error) { err.textContent = error.message.includes('already registered') ? '·Äí·ÄÆ Email ·ÄÄ·Ä≠·ÄØ ·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫·Åã Login ·ÅÄ·ÄÑ·Ä∫·Äï·Ä´·Åã' : error.message; err.style.display = 'block'; return; }
        showAuthSuccess('Confirmation Email ·Äï·Ä≠·ÄØ·Ä∑·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ!', `${email} ·ÄÄ·Ä≠·ÄØ Confirmation Link ·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä±·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã Email Inbox (·Äû·Ä≠·ÄØ·Ä∑) Spam folder ·ÄÄ·Ä≠·ÄØ ·ÄÖ·ÄÖ·Ä∫·Äï·Äº·ÄÆ·Ä∏ Link ·ÄÄ·Ä≠·ÄØ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´·Åã`);
    };

    window.sendResetLink = async () => {
        const email = document.getElementById('resetEmail').value.trim(), btn = document.getElementById('resetBtn'), err = document.getElementById('loginError');
        if (!email) { err.textContent = 'Email ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´'; err.style.display = 'block'; return; }
        btn.classList.add('loading'); btn.disabled = true; err.style.display = 'none';
        const { error } = await resetPassword(email);
        btn.classList.remove('loading'); btn.disabled = false;
        if (error) { err.textContent = error.message; err.style.display = 'block'; return; }
        showAuthSuccess('Reset Link ·Äï·Ä≠·ÄØ·Ä∑·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ!', `${email} ·ÄÄ·Ä≠·ÄØ Password Reset Link ·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä±·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã Email Inbox ·ÄÖ·ÄÖ·Ä∫·Äï·Ä´·Åã`);
    };

    document.addEventListener('keydown', (e) => {
        if (e.key !== 'Enter') return;
        const lv = document.getElementById('loginFormView'), rv = document.getElementById('registerFormView'), fv = document.getElementById('forgotPasswordView');
        if (lv && lv.style.display !== 'none' && lv.style.display !== '') { if ([document.getElementById('loginEmail'), document.getElementById('loginPassword')].includes(document.activeElement)) loginWithEmail(); }
        if (rv && rv.style.display === 'block') { if (['regName','regEmail','regPassword'].some(f => document.activeElement === document.getElementById(f))) registerWithEmail(); }
        if (fv && fv.style.display === 'block') { if (document.activeElement === document.getElementById('resetEmail')) sendResetLink(); }
    });

    // ========== GOOGLE AUTH ==========
    window.loginWithGoogle = async () => {
        const btn = document.getElementById('googleBtn'); btn.classList.add('loading'); btn.disabled = true;
        const { error } = await signInWithGoogle();
        if (error) { btn.classList.remove('loading'); btn.disabled = false; document.getElementById('loginError').textContent = 'Google Login ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åã'; document.getElementById('loginError').style.display = 'block'; }
    };

    let initInProgress = false;

    // Auth initialization ‚Äî use onAuthChange as single entry point
    onAuthChange(async (event, session) => {
        if ((event === 'SIGNED_IN' || event === 'INITIAL_SESSION' || event === 'TOKEN_REFRESHED') && session?.user && !currentCustomer && !initInProgress) {
            showLoginLoading();
            await initDashboard(session.user);
        }
    });

    let loginLoadingTimer = null;
    function showLoginLoading() {
        ['loginFormView','registerFormView','forgotPasswordView','authSuccessView'].forEach(id => { const e = document.getElementById(id); if (e) e.style.display = 'none'; });
        document.getElementById('loginError').style.display = 'none';
        document.getElementById('loginLoading').style.display = 'block';
        clearTimeout(loginLoadingTimer);
        loginLoadingTimer = setTimeout(() => { if (document.getElementById('loginLoading').style.display === 'block' && !currentCustomer) { document.getElementById('loginLoading').style.display = 'none'; showLogin(); const e = document.getElementById('loginError'); e.textContent = 'Connection timed out. Please try again.'; e.style.display = 'block'; signOutCustomer(); } }, 45000);
    }

    async function initDashboard(authUser) {
        initInProgress = true;
        try {
            currentCustomer = await findOrCreateCustomer(authUser);
            clearTimeout(loginLoadingTimer);
            if (!currentCustomer || !currentCustomer.is_active) { document.getElementById('loginLoading').style.display = 'none'; showLogin(); document.getElementById('loginError').textContent = '·Äû·ÄÑ·Ä∑·Ä∫·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÄ·Ä≠·ÄØ ·Äï·Ä≠·Äê·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã Admin ·ÄÄ·Ä≠·ÄØ ·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äï·Ä´·Åã'; document.getElementById('loginError').style.display = 'block'; await signOutCustomer(); return; }
            currentCustomer._avatarUrl = authUser.user_metadata?.avatar_url || currentCustomer.avatar_url || null;
            const ls = document.getElementById('loginSection'); ls.style.transition = 'opacity .4s ease, transform .4s ease'; ls.style.opacity = '0'; ls.style.transform = 'scale(1.02)';
            setTimeout(() => { ls.style.display = 'none'; const d = document.getElementById('dashboardSection'); d.classList.remove('hidden'); d.classList.add('dashboard-enter'); renderHeader(); loadProducts(); }, 380);
        } catch (err) { initInProgress = false; document.getElementById('loginLoading').style.display = 'none'; showLogin(); document.getElementById('loginError').textContent = 'Error: ' + err.message; document.getElementById('loginError').style.display = 'block'; }
    }

    window.logout = async () => { await signOutCustomer(); location.reload(); };
    window.refreshDashboard = () => { if (currentCustomer) { const b = document.querySelector('.btn-refresh'); b.style.opacity = '.6'; b.textContent = '...'; loadProducts().then(() => { b.style.opacity = '1'; b.textContent = 'Refresh'; }); } };

    function getInitials(n) { return n.split(' ').map(w => w[0]).join('').toUpperCase().slice(0, 2); }
    function renderHeader() {
        document.getElementById('customerName').innerText = `Welcome, ${currentCustomer.name}`;
        document.getElementById('customerEmail').innerText = currentCustomer.email;
        const i = getInitials(currentCustomer.name), a = currentCustomer._avatarUrl;
        const nav = document.getElementById('navAvatarInitial'); if (a) nav.innerHTML = `<img src="${a}" alt="">`; else nav.textContent = i;
        const w = document.getElementById('welcomeAvatarWrap'); if (a) w.innerHTML = `<img src="${a}" alt="" style="width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid var(--accent-green);">`; else w.innerHTML = `<div class="avatar-fallback">${i}</div>`;
        document.getElementById('thankYouText').innerHTML = `Dear <strong>${currentCustomer.name}</strong>,<br><br>ART de ONE ·ÄÄ·Ä≠·ÄØ ·Äö·ÄØ·Ä∂·ÄÄ·Äº·Ää·Ä∫·ÄÖ·Ä≠·Äê·Ä∫·ÄÅ·Äª·ÄÖ·ÄΩ·Ä¨ ·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äï·Ä±·Ä∏·Äê·Ä≤·Ä∑·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·Ä°·Äë·Ä∞·Ä∏·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äê·ÄÑ·Ä∫·Äõ·Äæ·Ä≠·Äï·Ä´·Äê·Äö·Ä∫·Åã ${currentCustomer.name.split(' ')[0]} ·Äõ·Ä≤·Ä∑ ·Äú·ÄØ·Äï·Ä∫·ÄÑ·Äî·Ä∫·Ä∏·Äê·ÄΩ·Ä±·Åä ·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äô·Äæ·ÄØ·Äê·ÄΩ·Ä±·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·ÄÄ·Äª·ÄΩ·Äî·Ä∫·Äê·Ä±·Ä¨·Ä∫·Äê·Ä≠·ÄØ·Ä∑·Äõ·Ä≤·Ä∑ Products ·Äê·ÄΩ·Ä±·ÄÄ ·Ä°·ÄÄ·Ä∞·Ä°·Ää·ÄÆ·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·ÄÖ·Ä±·Äú·Ä≠·ÄØ·Ä∑ ·ÄÜ·ÄØ·Äô·ÄΩ·Äî·Ä∫·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äï·Ä´·Äê·Äö·Ä∫·Åã ·Äò·Ä¨·Ä°·ÄÅ·ÄÄ·Ä∫·Ä°·ÄÅ·Ä≤·Äï·Ä≤ ·Äõ·Äæ·Ä≠·Äõ·Äæ·Ä≠ ·ÄÄ·Äª·ÄΩ·Äî·Ä∫·Äê·Ä±·Ä¨·Ä∫·Äê·Ä≠·ÄØ·Ä∑·ÄÄ·Ä≠·ÄØ ·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫·Äô·Äõ·ÄΩ·Ä±·Ä∏ ·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫·Äî·Ä±·Ä¨·Ä∫·Åã<br><br>·ÄÅ·Äª·ÄÖ·Ä∫·ÄÅ·ÄÑ·Ä∫·Äú·Ä±·Ä∏·ÄÖ·Ä¨·Ä∏·Äú·Äª·ÄÄ·Ä∫,<br><strong>ART de ONE Team</strong> üíö`;
    }

    async function loadProducts() {
        const c = document.getElementById('productsContainer'); c.innerHTML = '<div class="loading-spinner">Loading...</div>';
        const { data: dl } = await supabaseShop.from('shop_customer_downloads').select('product_id').eq('customer_id', currentCustomer.id).eq('is_active', true);
        purchasedProductIds = (dl || []).map(d => d.product_id);
        const { data: pr } = await supabaseShop.from('shop_products').select('*').eq('is_active', true);
        allProducts = pr || [];
        const pp = allProducts.filter(p => purchasedProductIds.includes(p.id)), up = allProducts.filter(p => !purchasedProductIds.includes(p.id));
        if (pp.length === 0) { c.innerHTML = `<div class="empty-state"><div class="icon">üì¶</div><p>·Äû·ÄÑ·Ä∑·Ä∫·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´·Åã<br>·Ä°·Ä±·Ä¨·ÄÄ·Ä∫·Äò·ÄÄ·Ä∫·Äô·Äæ ·ÅÄ·Äö·Ä∫·Äö·Ä∞·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·ÄÄ ·Ä§·Äî·Ä±·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Äï·Ä±·Ä´·Ä∫·Äú·Ä¨·Äï·Ä´·Äô·Ää·Ä∫·Åã</p></div>`; }
        else { c.innerHTML = `<div class="product-grid">${pp.map(p => { const ic = p.category === 'course'; return `<div class="product-card"><div class="thumb-wrapper">${ic ? '<span class="course-card-badge"><i class="fas fa-play-circle" style="margin-right:3px;"></i>Course</span>' : ''}<img class="thumb" src="${p.thumbnail_url || ''}" alt="${p.name}" onerror="this.style.display='none'" loading="lazy" /></div><div class="card-body"><div class="product-name">${p.name}</div><span class="category-badge">${PRODUCT_CATEGORIES[p.category] || p.category}</span>${ic ? `<button onclick="openCourse('${p.id}')" class="btn-download" style="background:var(--primary-black);color:var(--accent-green);"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><polygon points="5 3 19 12 5 21 5 3"/></svg>Start Learning</button>` : `<a href="${p.download_url}" target="_blank" rel="noopener noreferrer" class="btn-download"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Download</a>`}</div></div>`; }).join('')}</div>`; }
        const bs = document.getElementById('browseSection'), bc = document.getElementById('browseContainer');
        if (up.length > 0) { bs.style.display = 'block'; bc.innerHTML = `<div class="product-grid">${up.map(p => { const ic = p.category === 'course', inC = cart.some(x => x.id === p.id); return `<div class="product-card browse-card"><div class="thumb-wrapper">${ic ? '<span class="course-card-badge"><i class="fas fa-play-circle" style="margin-right:3px;"></i>Course</span>' : ''}<img class="thumb" src="${p.thumbnail_url || ''}" alt="${p.name}" onerror="this.style.display='none'" loading="lazy" /></div><div class="card-body"><div class="product-name">${p.name}</div><span class="category-badge">${PRODUCT_CATEGORIES[p.category] || p.category}</span><div class="browse-price">${Number(p.price).toLocaleString()} <span>MMK</span></div><button onclick="addToCart('${p.id}')" class="btn-buy ${inC ? 'added' : ''}" id="buy-${p.id}"><i class="fas ${inC ? 'fa-check' : 'fa-shopping-bag'}"></i>${inC ? 'Added' : 'Buy'}</button></div></div>`; }).join('')}</div>`; }
        else { bs.style.display = 'block'; bc.innerHTML = `<div style="text-align:center;padding:50px 24px;background:var(--primary-white);border-radius:var(--radius-lg);border:1px solid rgba(0,0,0,.05);box-shadow:var(--shadow-sm);"><div style="font-size:2.8em;margin-bottom:14px;opacity:.2;">üéâ</div><p style="color:#bbb;font-size:.88em;line-height:1.9;max-width:340px;margin:0 auto;">All products purchased!</p></div>`; }
    }

    // ========== CART ==========
    window.addToCart = (id) => { const p = allProducts.find(x => x.id === id); if (!p || cart.some(x => x.id === id)) return; cart.push(p); updateCartUI(); const b = document.getElementById(`buy-${id}`); if (b) { b.classList.add('added'); b.innerHTML = '<i class="fas fa-check"></i> Added'; } openCart(); };
    window.removeFromCart = (id) => { cart = cart.filter(x => x.id !== id); updateCartUI(); const b = document.getElementById(`buy-${id}`); if (b) { b.classList.remove('added'); b.innerHTML = '<i class="fas fa-shopping-bag"></i> Buy'; } };
    function updateCartUI() { const ce = document.getElementById('cartCount'); if (cart.length > 0) { ce.textContent = cart.length; ce.classList.remove('hidden-count'); } else ce.classList.add('hidden-count'); const ci = document.getElementById('cartItems'); if (cart.length === 0) ci.innerHTML = `<div class="cart-empty"><i class="fas fa-shopping-bag"></i><p style="font-size:.85em;">Your cart is empty</p></div>`; else ci.innerHTML = cart.map(p => `<div class="cart-item"><img src="${p.thumbnail_url || ''}" alt="${p.name}" class="cart-item-img" onerror="this.style.background='#eee'"><div class="cart-item-info"><div class="cart-item-name">${p.name}</div><div class="cart-item-price">${Number(p.price).toLocaleString()} MMK</div></div><button onclick="removeFromCart('${p.id}')" class="cart-item-remove"><i class="fas fa-times"></i></button></div>`).join(''); const t = cart.reduce((s, p) => s + Number(p.price), 0); document.getElementById('cartTotal').textContent = t.toLocaleString() + ' MMK'; document.getElementById('orderBtn').disabled = cart.length === 0; document.getElementById('orderBtn').style.opacity = cart.length === 0 ? '.5' : '1'; }
    function openCart() { document.getElementById('cartOverlay').classList.add('active'); document.getElementById('cartSlidein').classList.add('active'); document.body.style.overflow = 'hidden'; }
    function closeCart() { document.getElementById('cartOverlay').classList.remove('active'); document.getElementById('cartSlidein').classList.remove('active'); document.body.style.overflow = ''; }
    window.toggleCart = () => { document.getElementById('cartSlidein').classList.contains('active') ? closeCart() : openCart(); };
    window.closeCart = closeCart;
    window.placeOrder = async () => { if (cart.length === 0) return; const ob = document.getElementById('orderBtn'); ob.disabled = true; ob.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right:6px;"></i>Processing...'; try { const od = cart.map(p => ({ customer_id: currentCustomer.id, product_id: p.id, amount: Number(p.price), status: 'pending' })); const { error } = await supabaseShop.from('shop_orders').insert(od); if (error) { alert('Order Error: ' + error.message); ob.disabled = false; ob.innerHTML = '<i class="fas fa-paper-plane" style="margin-right:6px;"></i>Order'; return; } cart = []; updateCartUI(); closeCart(); showToast('Order placed! Admin ·ÄÄ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·ÄÄ ·Äõ·Äö·Ä∞·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äô·Ää·Ä∫·Åã'); await loadProducts(); } catch (e) { alert('Error: ' + e.message); } ob.disabled = false; ob.innerHTML = '<i class="fas fa-paper-plane" style="margin-right:6px;"></i>Order'; };
    function showToast(m) { const t = document.getElementById('toast'); document.getElementById('toastMsg').textContent = m; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 4000); }

    // ========== PROFILE ==========
    let customerOrders = [];
    function openProfile() { renderProfile(); loadOrderHistory(); document.getElementById('profileOverlay').classList.add('active'); document.getElementById('profileSlidein').classList.add('active'); document.body.style.overflow = 'hidden'; }
    function closeProfile() { document.getElementById('profileOverlay').classList.remove('active'); document.getElementById('profileSlidein').classList.remove('active'); document.body.style.overflow = ''; }
    window.toggleProfile = () => { document.getElementById('profileSlidein').classList.contains('active') ? closeProfile() : openProfile(); };
    window.closeProfile = closeProfile;
    function renderProfile() {
        if (!currentCustomer) return; const i = getInitials(currentCustomer.name), a = currentCustomer._avatarUrl;
        const ae = document.getElementById('profileAvatar'); if (a) ae.innerHTML = `<img src="${a}" alt="">`; else ae.textContent = i;
        document.getElementById('profileName').textContent = currentCustomer.name;
        document.getElementById('profileEmail').textContent = currentCustomer.email || '-';
        document.getElementById('profilePhone').textContent = currentCustomer.phone || '-';
        document.getElementById('statProducts').textContent = purchasedProductIds.length;
        const mi = document.getElementById('loginMethodIcon'), mv = document.getElementById('loginMethodValue');
        const prov = currentCustomer.auth_provider || 'email';
        if (prov === 'google') { mi.innerHTML = '<i class="fab fa-google"></i>'; mi.style.background = '#fef2f2'; mi.style.color = '#dc2626'; mv.textContent = 'Google Account'; }
        else { mi.innerHTML = '<i class="fas fa-envelope"></i>'; mi.style.background = '#eff6ff'; mi.style.color = '#2563eb'; mv.textContent = 'Email / Password'; }
        if (currentCustomer.created_at) { const d = new Date(currentCustomer.created_at); document.getElementById('profileDate').textContent = d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); }
    }
    async function loadOrderHistory() {
        const { data: o } = await supabaseShop.from('shop_orders').select('*, shop_products(name)').eq('customer_id', currentCustomer.id).order('created_at', { ascending: false });
        customerOrders = o || []; document.getElementById('statOrders').textContent = customerOrders.length;
        const c = document.getElementById('profileOrdersList');
        if (customerOrders.length === 0) { c.innerHTML = `<div class="profile-orders-empty"><i class="fas fa-receipt"></i><p>No orders yet</p></div>`; return; }
        const si = { pending: 'fa-clock', confirmed: 'fa-check-circle', delivered: 'fa-box-open', cancelled: 'fa-times-circle' }, sl = { pending: 'Pending', confirmed: 'Confirmed', delivered: 'Delivered', cancelled: 'Cancelled' };
        c.innerHTML = customerOrders.map(o => { const s = o.status || 'pending', d = new Date(o.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }); return `<div class="profile-order-item"><div class="order-icon ${s}"><i class="fas ${si[s] || 'fa-receipt'}"></i></div><div class="order-detail"><div class="order-name">${o.shop_products?.name || 'Product'}</div><div class="order-meta">${d} ¬∑ ${Number(o.amount).toLocaleString()} MMK</div></div><span class="order-status-badge ${s}">${sl[s] || s}</span></div>`; }).join('');
    }

    // ========== COURSE PLAYER ==========
    let courseLessons = [], lessonMaterialsMap = {}, currentLessonId = null, currentCourseId = null;
    window.openCourse = async (pid) => { currentCourseId = pid; document.getElementById('myProductsSection').classList.add('hidden'); document.getElementById('coursePlayerSection').classList.remove('hidden'); const { data: ls } = await supabaseShop.from('shop_course_lessons').select('*').eq('product_id', pid).order('sort_order', { ascending: true }); courseLessons = ls || []; lessonMaterialsMap = {}; if (courseLessons.length > 0) { const ids = courseLessons.map(l => l.id); const { data: ms } = await supabaseShop.from('shop_lesson_materials').select('*').in('lesson_id', ids).order('sort_order', { ascending: true }); (ms || []).forEach(m => { if (!lessonMaterialsMap[m.lesson_id]) lessonMaterialsMap[m.lesson_id] = []; lessonMaterialsMap[m.lesson_id].push(m); }); } renderLessonList(); if (courseLessons.length > 0) selectLesson(courseLessons[0].id); else { document.getElementById('lessonsList').innerHTML = '<p style="text-align:center;color:#999;padding:20px;">No lessons yet.</p>'; document.getElementById('currentLessonTitle').textContent = 'No lessons yet'; document.getElementById('currentLessonDesc').textContent = ''; document.getElementById('courseVideoPlayer').src = ''; document.getElementById('lessonMaterialsSection').style.display = 'none'; } window.scrollTo({ top: 0, behavior: 'smooth' }); };
    function renderLessonList() { const c = document.getElementById('lessonsList'); if (!courseLessons.length) { c.innerHTML = '<p style="text-align:center;color:#999;">No lessons.</p>'; return; } c.innerHTML = courseLessons.map((l, i) => { const m = lessonMaterialsMap[l.id] || []; return `<div class="lesson-list-item ${l.id === currentLessonId ? 'active' : ''}" onclick="selectLesson('${l.id}')"><span class="lesson-idx">${i + 1}</span><span class="lesson-title-text">${l.title}</span>${m.length > 0 ? `<span class="lesson-mat-badge"><i class="fas fa-paperclip" style="font-size:.7em;"></i> ${m.length}</span>` : ''}<span class="lesson-duration">${l.duration || ''}</span></div>`; }).join(''); }
    window.selectLesson = (id) => { currentLessonId = id; const l = courseLessons.find(x => x.id === id); if (!l) return; document.getElementById('courseVideoPlayer').src = l.video_url ? convertToEmbedUrl(l.video_url) : ''; document.getElementById('currentLessonTitle').textContent = l.title; document.getElementById('currentLessonDesc').textContent = l.description || ''; renderLessonMaterials(id); renderLessonList(); };
    function renderLessonMaterials(id) { const ms = lessonMaterialsMap[id] || [], s = document.getElementById('lessonMaterialsSection'); if (!ms.length) { s.style.display = 'none'; return; } s.style.display = 'block'; document.getElementById('materialCount').textContent = `${ms.length} file${ms.length !== 1 ? 's' : ''}`; document.getElementById('downloadAllBtn').style.display = ms.length > 1 ? 'flex' : 'none'; document.getElementById('materialsList').innerHTML = ms.map(m => `<div class="material-download-card"><div class="mat-icon ${m.file_type || 'other'}">${FILE_SVG}</div><div class="mat-details"><p class="mat-name">${m.title}</p><span class="mat-meta">${(m.file_type || 'file').toUpperCase()}${m.file_size ? ' ¬∑ ' + m.file_size : ''}</span></div><button onclick="downloadMaterial('${m.file_url}','${m.title.replace(/'/g, "\\'")}')" class="mat-download-btn"><i class="fas fa-download" style="font-size:.8em;"></i>Download</button></div>`).join(''); }
    window.downloadMaterial = (u, t) => { const a = document.createElement('a'); a.href = u; a.target = '_blank'; a.rel = 'noopener noreferrer'; document.body.appendChild(a); a.click(); document.body.removeChild(a); };
    window.downloadAllMaterials = () => { const m = lessonMaterialsMap[currentLessonId] || []; if (!m.length || !confirm(`Download all ${m.length} files?`)) return; m.forEach((x, i) => setTimeout(() => downloadMaterial(x.file_url, x.title), i * 500)); };
    function convertToEmbedUrl(u) { if (!u) return ''; const yt = u.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&?#]+)/); if (yt) return `https://www.youtube.com/embed/${yt[1]}`; const v = u.match(/vimeo\.com\/(\d+)/); if (v) return `https://player.vimeo.com/video/${v[1]}`; if (u.includes('drive.google.com')) { const f = u.match(/\/d\/([^/]+)/); if (f) return `https://drive.google.com/file/d/${f[1]}/preview`; } return u; }
    window.backToCourses = () => { document.getElementById('coursePlayerSection').classList.add('hidden'); document.getElementById('myProductsSection').classList.remove('hidden'); currentLessonId = null; currentCourseId = null; document.getElementById('courseVideoPlayer').src = ''; };
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeCart(); closeProfile(); } });
    </script>
</body>
</html>
