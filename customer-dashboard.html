<!DOCTYPE html>
<html lang="my" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Customer Dashboard - ART de ONE</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/ddkd9lxpr/image/upload/v1769316272/fav-icon_n00lji.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CZRQ0NPPJ2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-CZRQ0NPPJ2');
    </script>
    <style>
        /* =====================================================
           DESIGN TOKENS — Light Mode
        ===================================================== */
        :root {
            --accent-green: #a7e169;
            --accent-red: #ed2939;
            --ease: cubic-bezier(.4,0,.2,1);
            --ease-spring: cubic-bezier(.34,1.56,.64,1);
            --radius-sm: 10px;
            --radius-md: 16px;
            --radius-lg: 22px;
            --radius-xl: 28px;

            /* Light */
            --bg: #f4f5f7;
            --surface: #ffffff;
            --surface-2: #f8f9fa;
            --border: rgba(0,0,0,.07);
            --border-strong: rgba(0,0,0,.12);
            --text-primary: #111318;
            --text-secondary: #6b7280;
            --text-muted: #adb5bd;
            --shadow-xs: 0 1px 3px rgba(0,0,0,.06);
            --shadow-sm: 0 2px 12px rgba(0,0,0,.06);
            --shadow-md: 0 8px 32px rgba(0,0,0,.08);
            --shadow-lg: 0 20px 60px rgba(0,0,0,.1);
            --nav-bg: rgba(255,255,255,.88);
            --card-hover-shadow: 0 16px 40px rgba(167,225,105,.15), 0 4px 12px rgba(0,0,0,.06);
            --green-subtle: rgba(167,225,105,.1);
            --red-subtle: rgba(237,41,57,.08);
        }

        /* =====================================================
           DESIGN TOKENS — Dark Mode
        ===================================================== */
        [data-theme="dark"] {
            --bg: #151713;
            --surface: #1c1f1a;
            --surface-2: #242822;
            --border: rgba(255,255,255,.07);
            --border-strong: rgba(255,255,255,.13);
            --text-primary: #edf0f5;
            --text-secondary: #8b95a8;
            --text-muted: #4e5668;
            --shadow-xs: 0 1px 3px rgba(0,0,0,.3);
            --shadow-sm: 0 2px 12px rgba(0,0,0,.3);
            --shadow-md: 0 8px 32px rgba(0,0,0,.35);
            --shadow-lg: 0 20px 60px rgba(0,0,0,.45);
            --nav-bg: rgba(21,23,19,.92);
            --card-hover-shadow: 0 16px 40px rgba(167,225,105,.08), 0 4px 16px rgba(0,0,0,.3);
            --green-subtle: rgba(167,225,105,.08);
            --red-subtle: rgba(237,41,57,.12);
        }

        /* =====================================================
           RESET & BASE
        ===================================================== */
        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
        html { scroll-behavior:smooth; }
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            transition: background .3s var(--ease), color .3s var(--ease);
        }
        ::-webkit-scrollbar { width:5px; }
        ::-webkit-scrollbar-track { background:transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius:10px; }
        *:focus-visible { outline:2px solid var(--accent-green); outline-offset:2px; }

        /* =====================================================
           GRAIN TEXTURE
        ===================================================== */
        .grain-btn { position:relative; overflow:hidden; isolation:isolate; }
        .grain-btn::after {
            content:''; position:absolute; inset:0; z-index:1; pointer-events:none; border-radius:inherit;
            opacity:.07; mix-blend-mode:overlay;
            background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='g'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23g)'/%3E%3C/svg%3E");
            background-size:128px 128px;
        }
        .grain-btn:hover::after { opacity:.11; }

        /* =====================================================
           UTILITY
        ===================================================== */
        .hidden { display:none !important; }
        .container { max-width:1200px; margin:0 auto; padding:28px 24px; }

        @keyframes fadeSlideUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
        @keyframes authViewIn { from{opacity:0;transform:translateY(14px) scale(.97)} to{opacity:1;transform:translateY(0) scale(1)} }
        @keyframes spin { to{transform:rotate(360deg)} }
        @keyframes cardStagger { from{opacity:0;transform:translateY(18px) scale(.98)} to{opacity:1;transform:translateY(0) scale(1)} }
        @keyframes cartPop { from{transform:scale(0)} to{transform:scale(1)} }
        @keyframes badgePulse { 0%,100%{opacity:.5;transform:scale(.9)} 50%{opacity:1;transform:scale(1.1)} }
        @keyframes cursorBlink { 0%,100%{opacity:1} 50%{opacity:0} }
        @keyframes errorShake { 0%,100%{transform:translateX(0)} 20%{transform:translateX(-6px)} 40%{transform:translateX(6px)} 60%{transform:translateX(-3px)} 80%{transform:translateX(3px)} }
        @keyframes dashboardFadeIn { from{opacity:0} to{opacity:1} }
        @keyframes emptyFloat { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
        @keyframes blob { 0%{transform:translate(0,0) scale(1)} 33%{transform:translate(30px,-50px) scale(1.1)} 66%{transform:translate(-20px,20px) scale(.9)} 100%{transform:translate(0,0) scale(1)} }
        @keyframes orgPulse { 0%,100%{opacity:.5;transform:scale(1)} 50%{opacity:.8;transform:scale(1.05)} }
        @keyframes loginCardIn { from{opacity:0;transform:translateY(24px) scale(.97)} to{opacity:1;transform:translateY(0) scale(1)} }
        @keyframes shimmer { 0%{background-position:-200% 0} 100%{background-position:200% 0} }

        .auth-view-animate { animation:authViewIn .5s var(--ease) both; }
        .dashboard-enter { animation:dashboardFadeIn .5s var(--ease) both; }

        /* =====================================================
           NAV
        ===================================================== */
        .top-nav {
            background: var(--nav-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            position: sticky; top:0; z-index:100;
            transition: box-shadow .3s var(--ease), background .3s var(--ease);
        }
        .top-nav.scrolled { box-shadow: var(--shadow-sm); }
        .nav-container {
            max-width:1200px; margin:0 auto;
            padding:0 24px;
            display:flex; justify-content:space-between; align-items:center; height:62px;
        }
        .nav-logo img { height:28px; display:block; transition:transform .3s var(--ease); }
        .nav-logo img:hover { transform:scale(1.04); }
        .nav-actions { display:flex; gap:6px; align-items:center; }

        /* Nav Buttons */
        .btn {
            padding:8px 18px; border-radius:10px; border:none; cursor:pointer;
            font-weight:600; font-family:'Poppins',sans-serif; font-size:.8em;
            transition:all .22s var(--ease); position:relative; overflow:hidden; letter-spacing:.01em;
            white-space:nowrap;
        }
        .btn:active { transform:scale(.95); }

        .btn-refresh {
            background: var(--accent-green); color:#000;
            box-shadow: 0 2px 8px rgba(167,225,105,.2);
        }
        .btn-refresh:hover { background:#96d158; transform:translateY(-1px); box-shadow:0 4px 14px rgba(167,225,105,.3); }

        .btn-logout {
            background: var(--red-subtle); color: var(--accent-red);
            border:1px solid rgba(237,41,57,.1);
        }
        .btn-logout:hover { background:rgba(237,41,57,.15); }

        /* Profile button */
        .btn-profile {
            background: var(--surface); color:var(--text-primary);
            border:1px solid var(--border); padding:7px 14px;
            display:flex; align-items:center; gap:7px;
        }
        .btn-profile:hover { border-color:var(--accent-green); background:var(--surface-2); }
        .btn-profile .profile-avatar-sm {
            width:24px; height:24px; border-radius:50%;
            background: var(--text-primary); color:var(--accent-green);
            display:flex; align-items:center; justify-content:center;
            font-size:.62em; font-weight:700; font-family:'Space Grotesk',sans-serif; overflow:hidden;
        }
        .btn-profile .profile-avatar-sm img { width:100%; height:100%; object-fit:cover; }
        .btn-profile span { font-size:.8em; }

        /* Cart button */
        .btn-cart {
            background: var(--surface); color:var(--text-primary);
            border:1px solid var(--border); position:relative; padding:8px 13px;
        }
        .btn-cart:hover { border-color:var(--accent-green); background:var(--surface-2); }
        .btn-cart i { font-size:1em; }
        .cart-count {
            position:absolute; top:-5px; right:-5px;
            background:var(--accent-red); color:#fff;
            font-size:.58em; font-weight:700; width:18px; height:18px;
            border-radius:50%; display:flex; align-items:center; justify-content:center;
            animation:cartPop .3s var(--ease-spring); border:2px solid var(--bg);
        }
        .cart-count.hidden-count { display:none; }

        /* Floating Dark mode toggle */
        .theme-toggle-float {
            position:fixed; bottom:2rem; right:2rem; z-index:100;
            width:3rem; height:3rem; border-radius:50%;
            background:#323232; color:#fff;
            border:none;
            display:flex; align-items:center; justify-content:center;
            cursor:pointer; opacity:.3;
            transition:all .3s var(--ease);
            box-shadow:0 4px 10px rgba(0,0,0,.1);
            font-size:1em;
        }
        [data-theme="dark"] .theme-toggle-float { background:#fff; color:#000; }
        .theme-toggle-float:hover { opacity:1; transform:scale(1.1); }

        /* =====================================================
           LOGIN PAGE
        ===================================================== */
        .login-section { display:flex; min-height:100vh; }

        .login-left {
            flex:1; background:#000;
            display:flex; align-items:center; justify-content:center;
            position:relative; overflow:hidden;
        }
        .login-left video { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:.8; }
        .login-left-overlay {
            position:absolute; inset:0;
            background:linear-gradient(135deg, rgba(0,0,0,.5) 0%, rgba(0,0,0,.2) 100%);
        }
        .login-left-content {
            position:relative; z-index:2; text-align:center; padding:40px;
        }
        .login-left-tagline {
            color:rgba(255,255,255,.9); font-size:.88em; font-weight:500;
            letter-spacing:.04em; margin-bottom:8px;
        }
        .login-left-title {
            color:#fff; font-family:'Space Grotesk',sans-serif; font-size:2em;
            font-weight:700; letter-spacing:-.02em; line-height:1.2;
        }
        .login-left-title span { color:var(--accent-green); }

        .go-to-shop-btn {
            position:absolute; bottom:28px; left:28px; z-index:10;
            display:inline-flex; align-items:center; gap:8px;
            padding:10px 22px;
            background:rgba(255,255,255,.12); backdrop-filter:blur(12px);
            border:1px solid rgba(255,255,255,.2); border-radius:2rem;
            color:#fff; font-family:'Poppins',sans-serif; font-size:.8em;
            font-weight:600; text-decoration:none; transition:all .3s ease; letter-spacing:.02em;
        }
        .go-to-shop-btn:hover { background:var(--accent-green); border-color:var(--accent-green); color:#000; transform:translateY(-2px); box-shadow:0 8px 24px rgba(167,225,105,.3); }

        .login-right {
            flex:1; display:flex; align-items:center; justify-content:center;
            padding:40px; background:var(--surface);
            transition:background .3s var(--ease);
        }
        .login-card {
            max-width:420px; width:100%;
            animation:loginCardIn .6s var(--ease) both;
        }
        .login-card .logo-wrap { text-align:center; margin-bottom:28px; }
        .login-card .logo-wrap img { height:36px; }
        .login-card h2 {
            text-align:center; margin-bottom:8px;
            font-family:'Space Grotesk',sans-serif; font-size:1.45em; font-weight:700;
            letter-spacing:-.025em; color:var(--text-primary);
        }
        .login-card .login-subtitle {
            text-align:center; color:var(--text-muted); font-size:.85em;
            margin-bottom:28px; line-height:1.6;
        }

        /* Auth Buttons */
        .login-google-btn {
            display:flex; align-items:center; justify-content:center; gap:12px;
            width:100%; padding:14px 24px;
            background:var(--accent-green); border:1px solid var(--accent-green); border-radius:2rem;
            font-family:'Poppins',sans-serif; font-size:.92em; font-weight:600; color:#000;
            cursor:pointer; transition:all .3s ease;
            box-shadow:inset 0 0 12px 3px rgba(255,255,255,.4),0 0 18px 4px rgba(167,225,105,.12);
        }
        .login-google-btn:hover {
            background:var(--accent-red); border-color:var(--accent-red); color:#fff; transform:translateY(-2px);
            box-shadow:inset 0 0 14px 4px rgba(255,255,255,.35),0 0 25px 6px rgba(237,41,57,.15);
        }
        .login-google-btn:active { transform:scale(.98) translateY(0); }
        .login-google-btn svg { width:20px; height:20px; flex-shrink:0; }
        .login-google-btn .btn-loading { display:none; }
        .login-google-btn.loading .btn-text { display:none; }
        .login-google-btn.loading .btn-loading { display:flex; align-items:center; gap:8px; }

        .login-signin-btn {
            width:100%; padding:14px 24px;
            background:var(--text-primary); color:var(--surface);
            border:1px solid var(--text-primary); border-radius:2rem;
            font-family:'Poppins',sans-serif; font-size:.92em; font-weight:600;
            cursor:pointer; transition:all .3s ease; margin-top:4px;
        }
        .login-signin-btn:hover { background:var(--accent-green); border-color:var(--accent-green); color:#000; transform:translateY(-2px); }
        .login-signin-btn:active { transform:scale(.98); }
        .login-signin-btn:disabled { opacity:.6; cursor:not-allowed; transform:none!important; }
        .login-signin-btn .btn-loading { display:none; }
        .login-signin-btn.loading .btn-text { display:none; }
        .login-signin-btn.loading .btn-loading { display:inline-flex; align-items:center; gap:8px; }

        .login-create-btn {
            width:100%; padding:14px 24px;
            background:var(--accent-red); color:#fff;
            border:1px solid var(--accent-red); border-radius:2rem;
            font-family:'Poppins',sans-serif; font-size:.92em; font-weight:600;
            cursor:pointer; transition:all .3s ease;
        }
        .login-create-btn:hover { background:var(--accent-green); border-color:var(--accent-green); color:#000; transform:translateY(-2px); }
        .login-create-btn:active { transform:scale(.98); }
        .login-create-btn:disabled { opacity:.6; cursor:not-allowed; transform:none!important; }
        .login-create-btn .btn-loading { display:none; }
        .login-create-btn.loading .btn-text { display:none; }
        .login-create-btn.loading .btn-loading { display:inline-flex; align-items:center; gap:8px; }

        .login-back-btn {
            width:100%; padding:13px 24px;
            background:transparent; color:var(--text-muted);
            border:1.5px solid var(--border-strong); border-radius:2rem;
            font-family:'Poppins',sans-serif; font-size:.88em; font-weight:500;
            cursor:pointer; transition:all .3s ease; margin-top:8px;
        }
        .login-back-btn:hover { border-color:var(--accent-green); color:var(--text-primary); transform:translateY(-1px); }

        /* Auth Form */
        .login-divider { display:flex; align-items:center; gap:16px; margin:18px 0; color:var(--text-muted); font-size:.76em; }
        .login-divider::before,.login-divider::after { content:''; flex:1; height:1px; background:var(--border); }
        .auth-form-group { margin-bottom:12px; }
        .auth-input {
            width:100%; padding:13px 16px;
            border:1.5px solid var(--border); border-radius:12px;
            font-family:'Poppins',sans-serif; font-size:.88em;
            transition:all .3s var(--ease);
            background:var(--surface-2); color:var(--text-primary);
        }
        .auth-input:hover { border-color:var(--border-strong); }
        .auth-input:focus { outline:none; border-color:var(--accent-green); box-shadow:0 0 0 4px rgba(167,225,105,.1); background:var(--surface); }
        .auth-input::placeholder { color:var(--text-muted); }
        .auth-links { display:flex; justify-content:center; gap:20px; margin-top:16px; }
        .auth-link { background:none; border:none; color:var(--text-muted); font-size:.78em; cursor:pointer; font-family:'Poppins',sans-serif; transition:color .2s; padding:0; }
        .auth-link:hover { color:var(--text-primary); text-decoration:underline; }
        .auth-link-create { color:var(--accent-red); }
        .auth-link-create:hover { color:#c41f2f; }
        .password-hint { font-size:.72em; color:var(--text-muted); margin-top:4px; margin-bottom:12px; }

        /* Trust Badges */
        .trust-badges {
            display:flex; flex-wrap:wrap; justify-content:center; gap:12px;
            margin-top:20px; padding-top:18px; border-top:1px solid var(--border);
        }
        .trust-badge-item { display:flex; align-items:center; gap:5px; font-size:.66em; color:var(--text-muted); font-weight:500; letter-spacing:.02em; }
        .trust-badge-item i { font-size:.9em; }
        .trust-badge-item .tb-ssl { color:#16a34a; }
        .trust-badge-item .tb-dmca { color:#2563eb; }
        .trust-badge-item .tb-verified { color:#ca8a04; }
        .trust-badge-item .tb-safe { color:#16a34a; }

        /* Auth States */
        .login-error {
            color:var(--accent-red); font-size:.8em; text-align:center; margin-top:14px; display:none;
            animation:errorShake .4s var(--ease);
            background:var(--red-subtle); padding:10px 16px; border-radius:10px;
            border:1px solid rgba(237,41,57,.12);
        }
        .login-loading-state { text-align:center; padding:40px 20px; display:none; }
        .login-loading-state .spinner {
            width:36px; height:36px;
            border:3px solid var(--border); border-top-color:var(--accent-green);
            border-radius:50%; animation:spin .7s linear infinite; margin:0 auto 16px;
        }
        .login-loading-state p { color:var(--text-muted); font-size:.88em; }
        .auth-success-box { text-align:center; padding:24px 0; animation:fadeSlideUp .5s var(--ease) both; }
        .auth-success-box .success-icon { font-size:2.8em; margin-bottom:16px; display:block; }
        .auth-success-box h3 { font-family:'Space Grotesk',sans-serif; font-size:1.1em; font-weight:700; margin-bottom:8px; color:var(--text-primary); }
        .auth-success-box p { color:var(--text-muted); font-size:.85em; line-height:1.7; }

        /* =====================================================
           DASHBOARD — WELCOME HEADER
        ===================================================== */
        .welcome-header {
            background: var(--surface);
            border:1px solid var(--border);
            border-radius:var(--radius-xl);
            padding:28px 32px;
            margin-bottom:24px;
            position:relative; overflow:hidden;
            box-shadow:var(--shadow-sm);
            animation:fadeSlideUp .5s var(--ease) both;
            display:flex; align-items:center; gap:20px;
        }
        .welcome-header::before {
            content:''; position:absolute; top:0; right:0;
            width:280px; height:280px;
            background:radial-gradient(circle at top right, rgba(167,225,105,.12) 0%, transparent 65%);
            pointer-events:none;
        }
        [data-theme="dark"] .welcome-header::before { background:radial-gradient(circle at top right, rgba(167,225,105,.07) 0%, transparent 65%); }
        .welcome-header .org-blob {
            position:absolute; border-radius:50%; filter:blur(40px); pointer-events:none; z-index:0;
        }
        .welcome-header .org-blob-1 {
            width:120px; height:120px; background:rgba(167,225,105,.15);
            top:-20px; right:60px; animation:blob 7s infinite;
        }
        .welcome-header .org-blob-2 {
            width:80px; height:80px; background:rgba(237,41,57,.1);
            bottom:-10px; left:30%; animation:blob 7s infinite 2s;
        }
        .welcome-header .org-blob-3 {
            width:100px; height:100px; background:rgba(167,225,105,.08);
            top:50%; left:-20px; animation:blob 7s infinite 4s;
        }
        [data-theme="dark"] .welcome-header .org-blob-1 { background:rgba(167,225,105,.08); }
        [data-theme="dark"] .welcome-header .org-blob-2 { background:rgba(237,41,57,.06); }
        [data-theme="dark"] .welcome-header .org-blob-3 { background:rgba(167,225,105,.05); }
        .btn-back-shop {
            display:inline-flex; align-items:center; gap:7px;
            padding:9px 20px; border-radius:2rem;
            background:var(--accent-green); color:#000;
            font-size:.78em; font-weight:600; font-family:'Poppins',sans-serif;
            text-decoration:none; transition:all .25s var(--ease);
            border:none; cursor:pointer; flex-shrink:0; letter-spacing:.01em; z-index:1;
            box-shadow:0 2px 8px rgba(167,225,105,.2);
        }
        .btn-back-shop:hover { background:var(--accent-red); color:#fff; transform:translateY(-2px); box-shadow:0 4px 14px rgba(237,41,57,.3); }
        .btn-back-shop:active { transform:scale(.96); }
        .btn-back-shop i { font-size:.9em; }
        [data-theme="dark"] .btn-back-shop { background:var(--accent-red); color:#fff; box-shadow:0 2px 8px rgba(237,41,57,.2); }
        [data-theme="dark"] .btn-back-shop:hover { background:var(--accent-green); color:#000; box-shadow:0 4px 14px rgba(167,225,105,.3); }
        .welcome-avatar-wrap-main { flex-shrink:0; position:relative; }
        .welcome-avatar-wrap-main .avatar-ring {
            width:60px; height:60px; border-radius:50%;
            border:2.5px solid var(--accent-green);
            padding:3px;
            background:var(--surface-2);
        }
        .welcome-avatar-wrap-main .avatar-ring img,
        .welcome-avatar-wrap-main .avatar-ring .avatar-fallback {
            width:100%; height:100%; border-radius:50%; object-fit:cover;
            display:flex; align-items:center; justify-content:center;
            font-family:'Space Grotesk',sans-serif; font-weight:700; font-size:1.1em;
            background:var(--text-primary); color:var(--accent-green);
        }
        .welcome-text-wrap { flex:1; min-width:0; }
        .welcome-header h1 {
            font-family:'Space Grotesk',sans-serif; font-size:1.4em; font-weight:700;
            letter-spacing:-.02em; line-height:1.25; color:var(--text-primary);
        }
        .welcome-header .email-text { color:var(--text-muted); font-size:.82em; margin-top:4px; }
        .badge {
            display:inline-flex; align-items:center; gap:5px;
            background:var(--text-primary); color:var(--surface);
            padding:5px 13px; border-radius:20px; font-size:.68em; font-weight:600;
            letter-spacing:.04em; margin-top:10px;
        }
        [data-theme="dark"] .badge { background:rgba(167,225,105,.15); color:var(--accent-green); border:1px solid rgba(167,225,105,.2); }
        .badge::before { content:''; width:6px; height:6px; border-radius:50%; background:var(--accent-green); animation:badgePulse 2s ease-in-out infinite; }

        /* =====================================================
           THANK YOU LETTER
        ===================================================== */
        .thank-you-letter {
            background: var(--surface);
            border:1px solid var(--border);
            border-radius:var(--radius-lg);
            padding:24px 32px;
            margin-bottom:32px;
            position:relative; overflow:hidden;
            box-shadow:var(--shadow-xs);
            animation:fadeSlideUp .5s var(--ease) .08s both;
        }
        .thank-you-letter::after {
            content:''; position:absolute; bottom:0; left:0; width:100%; height:3px;
            background:linear-gradient(90deg, var(--accent-green), var(--accent-red), var(--accent-green));
            opacity:.5;
        }
        .thank-you-letter .letter-icon { font-size:1.4em; margin-bottom:8px; display:block; }
        .thank-you-letter p { font-size:.87em; line-height:1.95; color:var(--text-secondary); }
        .thank-you-letter p strong { color:var(--text-primary); }
        .thank-you-letter .typewriter-cursor { display:inline-block; width:2px; height:1em; background:var(--accent-green); margin-left:2px; vertical-align:text-bottom; animation:cursorBlink .6s ease-in-out infinite; }

        /* =====================================================
           SECTION TITLE
        ===================================================== */
        .section-title {
            font-family:'Space Grotesk',sans-serif; font-size:1.15em; font-weight:700;
            margin-bottom:20px; letter-spacing:-.01em; color:var(--text-primary);
            animation:fadeSlideUp .5s var(--ease) .1s both;
            display:flex; align-items:center; gap:8px;
        }

        /* =====================================================
           PRODUCT GRID & CARDS
        ===================================================== */
        .product-grid {
            display:grid; grid-template-columns:repeat(3,1fr); gap:18px;
            animation:fadeSlideUp .5s var(--ease) .15s both;
        }

        .product-card {
            background:var(--surface); border:1px solid var(--border);
            border-radius:var(--radius-md); overflow:hidden;
            transition:all .3s var(--ease);
            box-shadow:var(--shadow-xs);
            opacity:0; animation:cardStagger .5s var(--ease) both;
        }
        .product-card:nth-child(1){animation-delay:.06s} .product-card:nth-child(2){animation-delay:.12s}
        .product-card:nth-child(3){animation-delay:.18s} .product-card:nth-child(4){animation-delay:.24s}
        .product-card:nth-child(5){animation-delay:.30s} .product-card:nth-child(6){animation-delay:.36s}
        .product-card:hover { transform:translateY(-5px); box-shadow:var(--card-hover-shadow); border-color:rgba(167,225,105,.25); }

        .product-card .thumb-wrapper { position:relative; overflow:hidden; background:var(--surface-2); }
        .product-card .thumb { width:100%; aspect-ratio:16/10; object-fit:cover; display:block; transition:transform .5s var(--ease); }
        .product-card:hover .thumb { transform:scale(1.04); }
        .product-card .card-body { padding:18px 20px 20px; }
        .product-card .product-name { font-family:'Space Grotesk',sans-serif; font-weight:600; font-size:.98em; margin-bottom:10px; line-height:1.35; letter-spacing:-.01em; color:var(--text-primary); }

        .category-badge {
            display:inline-flex; align-items:center;
            background:var(--green-subtle); color:#4a7c1a;
            padding:4px 12px; border-radius:20px; font-size:.7em; font-weight:600; margin-bottom:14px; letter-spacing:.02em;
        }
        [data-theme="dark"] .category-badge { color:#8dc840; }

        .btn-download {
            display:flex; align-items:center; justify-content:center; gap:8px;
            width:100%; padding:11px 20px; border-radius:50px;
            background:var(--accent-green); color:#000;
            font-weight:600; font-size:.82em; text-decoration:none; font-family:'Poppins',sans-serif;
            transition:all .3s var(--ease); border:none; cursor:pointer;
            box-shadow:0 2px 8px rgba(167,225,105,.2);
            position:relative; overflow:hidden;
        }
        .btn-download::before { content:''; position:absolute; inset:0; background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent); transform:translateX(-100%); transition:transform .5s var(--ease); }
        .btn-download:hover::before { transform:translateX(100%); }
        .btn-download:hover { background:var(--accent-red); color:#fff; box-shadow:0 4px 16px rgba(237,41,57,.2); transform:translateY(-1px); }
        .btn-download:active { transform:scale(.97); }
        .btn-download svg { width:15px; height:15px; flex-shrink:0; }

        .course-card-badge {
            position:absolute; top:10px; left:10px;
            background:var(--accent-red); color:#fff;
            font-size:.6em; font-weight:700; padding:3px 10px; border-radius:2rem; letter-spacing:.04em; text-transform:uppercase; z-index:2;
        }

        /* Empty / Loading */
        .empty-state {
            text-align:center; padding:64px 24px;
            background:var(--surface); border-radius:var(--radius-lg);
            border:1px solid var(--border); box-shadow:var(--shadow-xs);
            animation:fadeSlideUp .5s var(--ease) .15s both;
        }
        .empty-state .icon { font-size:3em; margin-bottom:16px; opacity:.2; display:block; animation:emptyFloat 3s ease-in-out infinite; }
        .empty-state p { color:var(--text-muted); font-size:.9em; line-height:1.8; max-width:300px; margin:0 auto; }

        .loading-spinner {
            text-align:center; padding:50px; color:var(--text-muted); font-size:.88em;
            animation:fadeSlideUp .4s var(--ease) both;
        }
        .loading-spinner::before {
            content:''; display:block; width:28px; height:28px; margin:0 auto 14px;
            border:2.5px solid var(--border-strong); border-top-color:var(--accent-green);
            border-radius:50%; animation:spin .7s linear infinite;
        }

        /* =====================================================
           BROWSE SECTION
        ===================================================== */
        .browse-section { margin-top:44px; animation:fadeSlideUp .5s var(--ease) .2s both; }
        .browse-card .card-body { display:flex; flex-direction:column; }
        .browse-price { font-family:'Space Grotesk',sans-serif; font-weight:700; font-size:1.08em; color:var(--text-primary); margin-bottom:12px; }
        .browse-price span { font-size:.7em; font-weight:400; color:var(--text-muted); }
        .btn-buy {
            display:flex; align-items:center; justify-content:center; gap:8px;
            width:100%; padding:11px 20px; border-radius:50px;
            background:var(--accent-red); color:#fff;
            font-weight:600; font-size:.82em; font-family:'Poppins',sans-serif;
            transition:all .3s var(--ease); border:none; cursor:pointer;
            box-shadow:0 2px 10px rgba(237,41,57,.15);
        }
        .btn-buy:hover { background:var(--accent-green); color:#000; box-shadow:0 4px 16px rgba(167,225,105,.3); transform:translateY(-1px); }
        .btn-buy:active { transform:scale(.97); }
        .btn-buy.added { background:var(--border-strong); color:var(--text-muted); box-shadow:none; pointer-events:none; }

        /* Pay Guide Button */
        .btn-pay-guide {
            display:inline-flex; align-items:center; gap:7px;
            padding:7px 16px; border-radius:20px;
            background:#ed2939; color:#fff;
            font-size:.73em; font-weight:700; font-family:'Poppins',sans-serif;
            border:none; cursor:pointer; transition:all .25s var(--ease);
            letter-spacing:.02em; white-space:nowrap; flex-shrink:0;
        }
        .btn-pay-guide:hover { background:#a7e169; color:#000; transform:translateY(-1px); box-shadow:0 4px 14px rgba(167,225,105,.3); }
        .btn-pay-guide:active { transform:scale(.96); }
        .btn-pay-guide svg { width:13px; height:13px; flex-shrink:0; }

        /* =====================================================
           PENDING ORDER NOTICE
        ===================================================== */
        .pending-notice {
            display:none; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;
            background:linear-gradient(135deg,rgba(254,243,199,.8),rgba(253,230,138,.4));
            border:1.5px solid #fbbf24; border-radius:var(--radius-md);
            padding:16px 20px; margin-bottom:20px;
            animation:fadeSlideUp .4s var(--ease) both;
        }
        [data-theme="dark"] .pending-notice { background:linear-gradient(135deg,rgba(120,80,0,.25),rgba(100,60,0,.15)); border-color:rgba(251,191,36,.3); }
        .pending-notice.show { display:flex; }
        .pending-notice-left { display:flex; align-items:center; gap:12px; }
        .pending-notice-icon {
            width:40px; height:40px; border-radius:10px;
            background:rgba(251,191,36,.2); display:flex; align-items:center; justify-content:center; font-size:1.1em; flex-shrink:0;
        }
        .pending-notice-text strong { display:block; font-size:.88em; font-weight:700; color:#92400e; margin-bottom:2px; }
        [data-theme="dark"] .pending-notice-text strong { color:#fbbf24; }
        .pending-notice-text span { font-size:.76em; color:#a16207; line-height:1.5; }
        [data-theme="dark"] .pending-notice-text span { color:#d9a520; }
        .pending-notice-btn {
            display:inline-flex; align-items:center; gap:6px;
            padding:8px 16px; border-radius:20px;
            background:#ed2939; color:#fff;
            font-size:.76em; font-weight:700; font-family:'Poppins',sans-serif;
            border:none; cursor:pointer; transition:all .25s var(--ease); white-space:nowrap; flex-shrink:0;
        }
        .pending-notice-btn:hover { background:#a7e169; color:#000; transform:translateY(-1px); }
        .pending-notice-btn:active { transform:scale(.96); }

        /* =====================================================
           TOAST
        ===================================================== */
        .toast {
            position:fixed; bottom:28px; left:50%;
            transform:translateX(-50%) translateY(100px);
            background:var(--text-primary); color:var(--surface);
            padding:13px 26px; border-radius:12px; font-size:.84em; font-weight:500;
            box-shadow:var(--shadow-lg); z-index:600;
            transition:transform .4s var(--ease-spring);
            display:flex; align-items:center; gap:10px;
            border:1px solid var(--border);
        }
        .toast.show { transform:translateX(-50%) translateY(0); }
        .toast i { color:var(--accent-green); }

        /* =====================================================
           CART SLIDEIN
        ===================================================== */
        .cart-overlay {
            position:fixed; inset:0; background:rgba(0,0,0,0);
            z-index:199; pointer-events:none; transition:background .35s var(--ease);
        }
        .cart-overlay.active { background:rgba(0,0,0,.45); pointer-events:auto; backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px); }
        .cart-slidein {
            position:fixed; top:0; right:0; bottom:0; width:380px; max-width:92vw;
            background:var(--surface); z-index:200;
            box-shadow:-8px 0 40px rgba(0,0,0,.15);
            display:flex; flex-direction:column;
            transform:translateX(100%); transition:transform .4s var(--ease);
            border-left:1px solid var(--border);
        }
        .cart-slidein.active { transform:translateX(0); }
        .cart-header {
            padding:22px 24px 18px; border-bottom:1px solid var(--border);
            display:flex; align-items:center; justify-content:space-between; flex-shrink:0;
        }
        .cart-header h3 { font-family:'Space Grotesk',sans-serif; font-size:1.05em; font-weight:700; display:flex; align-items:center; gap:8px; color:var(--text-primary); }
        .cart-header button { background:none; border:none; font-size:1.15em; cursor:pointer; color:var(--text-muted); padding:4px; transition:color .2s; }
        .cart-header button:hover { color:var(--text-primary); }
        .cart-items { flex:1; overflow-y:auto; padding:16px; }
        .cart-item { display:flex; align-items:center; gap:12px; padding:12px; background:var(--surface-2); border:1px solid var(--border); border-radius:var(--radius-sm); margin-bottom:10px; }
        .cart-item-img { width:52px; height:52px; object-fit:cover; border-radius:8px; background:var(--border); flex-shrink:0; }
        .cart-item-info { flex:1; min-width:0; }
        .cart-item-name { font-size:.84em; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:var(--text-primary); }
        .cart-item-price { font-size:.76em; color:var(--text-muted); margin-top:2px; }
        .cart-item-remove { background:none; border:none; cursor:pointer; color:var(--text-muted); padding:4px; font-size:.9em; transition:color .2s; }
        .cart-item-remove:hover { color:var(--accent-red); }
        .cart-empty { text-align:center; padding:40px 20px; color:var(--text-muted); }
        .cart-empty i { font-size:2em; opacity:.2; display:block; margin-bottom:10px; }
        .cart-footer { padding:16px 20px; border-top:1px solid var(--border); flex-shrink:0; }
        .cart-total { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
        .cart-total-label { font-size:.84em; color:var(--text-muted); font-weight:500; }
        .cart-total-value { font-size:1.15em; font-weight:700; color:var(--text-primary); font-family:'Space Grotesk',sans-serif; }
        .cart-footer .btn { width:100%; padding:12px; border-radius:12px; font-size:.9em; margin-bottom:8px; }
        .btn-order { background:var(--accent-green); color:#000; box-shadow:0 2px 10px rgba(167,225,105,.2); }
        .btn-order:hover { background:#96d158; box-shadow:0 4px 18px rgba(167,225,105,.3); }
        .btn-cancel-cart { background:var(--surface-2); color:var(--text-muted); border:1px solid var(--border); }
        .btn-cancel-cart:hover { background:var(--border); color:var(--text-secondary); }

        /* =====================================================
           PROFILE SLIDEIN
        ===================================================== */
        .profile-overlay {
            position:fixed; inset:0; background:rgba(0,0,0,0);
            z-index:199; pointer-events:none; transition:background .35s var(--ease);
        }
        .profile-overlay.active { background:rgba(0,0,0,.45); pointer-events:auto; backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px); }
        .profile-slidein {
            position:fixed; top:0; right:0; bottom:0; width:400px; max-width:92vw;
            background:var(--surface); z-index:200;
            box-shadow:-8px 0 40px rgba(0,0,0,.15);
            display:flex; flex-direction:column;
            transform:translateX(100%); transition:transform .4s var(--ease);
            border-left:1px solid var(--border);
        }
        .profile-slidein.active { transform:translateX(0); }
        .profile-header { padding:24px 24px 0; flex-shrink:0; }
        .profile-header-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
        .profile-header-top h3 { font-family:'Space Grotesk',sans-serif; font-size:1.1em; font-weight:700; display:flex; align-items:center; gap:8px; color:var(--text-primary); }
        .profile-header-top button { background:none; border:none; font-size:1.15em; cursor:pointer; color:var(--text-muted); padding:4px; transition:color .2s; }
        .profile-header-top button:hover { color:var(--text-primary); }
        .profile-avatar-wrap { text-align:center; padding-bottom:20px; border-bottom:1px solid var(--border); margin-bottom:0; }
        .profile-avatar {
            width:76px; height:76px; border-radius:50%;
            background:var(--text-primary); color:var(--accent-green);
            display:flex; align-items:center; justify-content:center;
            font-size:1.6em; font-weight:700; font-family:'Space Grotesk',sans-serif;
            margin:0 auto 12px; overflow:hidden;
            border:3px solid var(--accent-green);
            box-shadow:0 4px 20px rgba(167,225,105,.2);
        }
        .profile-avatar img { width:100%; height:100%; object-fit:cover; }
        .profile-avatar-wrap .profile-name { font-family:'Space Grotesk',sans-serif; font-size:1.1em; font-weight:700; margin-bottom:6px; color:var(--text-primary); }
        .profile-avatar-wrap .profile-status { display:inline-flex; align-items:center; gap:5px; font-size:.7em; font-weight:600; color:#16a34a; background:rgba(22,163,74,.1); padding:3px 12px; border-radius:20px; }
        .profile-avatar-wrap .profile-status::before { content:''; width:6px; height:6px; border-radius:50%; background:#16a34a; }
        .profile-content { flex:1; overflow-y:auto; padding:20px 24px 24px; }
        .profile-stats { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:20px; }
        .profile-stat-card { background:var(--surface-2); border:1px solid var(--border); border-radius:var(--radius-sm); padding:16px; text-align:center; }
        .profile-stat-card .stat-value { font-family:'Space Grotesk',sans-serif; font-size:1.6em; font-weight:700; color:var(--accent-green); margin-bottom:2px; }
        .profile-stat-card .stat-label { font-size:.7em; color:var(--text-muted); font-weight:500; }
        .profile-info-section { margin-bottom:20px; }
        .profile-info-label { font-size:.68em; font-weight:700; color:var(--text-muted); text-transform:uppercase; letter-spacing:.08em; margin-bottom:12px; padding-left:2px; }
        .profile-info-card { background:var(--surface-2); border:1px solid var(--border); border-radius:var(--radius-sm); overflow:hidden; }
        .profile-info-row { display:flex; align-items:center; gap:12px; padding:13px 16px; border-bottom:1px solid var(--border); }
        .profile-info-row:last-child { border-bottom:none; }
        .profile-info-row .info-icon { width:34px; height:34px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:.82em; flex-shrink:0; }
        .profile-info-row .info-icon.email-icon { background:#eff6ff; color:#2563eb; }
        .profile-info-row .info-icon.phone-icon { background:#f0fdf4; color:#16a34a; }
        .profile-info-row .info-icon.date-icon { background:#fefce8; color:#ca8a04; }
        .profile-info-row .info-icon.method-icon { background:#fef2f2; color:#dc2626; }
        [data-theme="dark"] .profile-info-row .info-icon.email-icon { background:rgba(37,99,235,.15); }
        [data-theme="dark"] .profile-info-row .info-icon.phone-icon { background:rgba(22,163,74,.15); }
        [data-theme="dark"] .profile-info-row .info-icon.date-icon { background:rgba(202,138,4,.15); }
        [data-theme="dark"] .profile-info-row .info-icon.method-icon { background:rgba(220,38,38,.15); }
        .profile-info-row .info-detail { flex:1; min-width:0; }
        .profile-info-row .info-detail .info-title { font-size:.7em; color:var(--text-muted); font-weight:500; margin-bottom:2px; }
        .profile-info-row .info-detail .info-value { font-size:.86em; font-weight:600; color:var(--text-primary); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .profile-orders-section { margin-bottom:8px; }
        .profile-order-item { display:flex; align-items:center; gap:12px; padding:12px 14px; background:var(--surface-2); border:1px solid var(--border); border-radius:var(--radius-sm); margin-bottom:8px; transition:all .2s var(--ease); }
        .profile-order-item:hover { border-color:var(--accent-green); }
        .profile-order-item .order-icon { width:34px; height:34px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:.78em; flex-shrink:0; }
        .profile-order-item .order-icon.pending { background:#fefce8; color:#ca8a04; }
        .profile-order-item .order-icon.confirmed { background:#f0fdf4; color:#16a34a; }
        .profile-order-item .order-icon.delivered { background:#eff6ff; color:#2563eb; }
        .profile-order-item .order-icon.cancelled { background:#fef2f2; color:#dc2626; }
        [data-theme="dark"] .profile-order-item .order-icon.pending { background:rgba(202,138,4,.15); }
        [data-theme="dark"] .profile-order-item .order-icon.confirmed { background:rgba(22,163,74,.15); }
        [data-theme="dark"] .profile-order-item .order-icon.delivered { background:rgba(37,99,235,.15); }
        [data-theme="dark"] .profile-order-item .order-icon.cancelled { background:rgba(220,38,38,.15); }
        .profile-order-item .order-detail { flex:1; min-width:0; }
        .profile-order-item .order-name { font-size:.84em; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:var(--text-primary); }
        .profile-order-item .order-meta { font-size:.7em; color:var(--text-muted); margin-top:2px; }
        .profile-order-item .order-status-badge { font-size:.63em; font-weight:700; padding:3px 10px; border-radius:20px; text-transform:uppercase; letter-spacing:.04em; flex-shrink:0; }
        .profile-order-item .order-status-badge.pending { background:#fefce8; color:#a16207; }
        .profile-order-item .order-status-badge.confirmed { background:#f0fdf4; color:#15803d; }
        .profile-order-item .order-status-badge.delivered { background:#eff6ff; color:#1d4ed8; }
        .profile-order-item .order-status-badge.cancelled { background:#fef2f2; color:#b91c1c; }
        .profile-orders-empty { text-align:center; padding:28px 0; color:var(--text-muted); font-size:.84em; }
        .profile-orders-empty i { display:block; font-size:1.5em; margin-bottom:8px; opacity:.3; }

        /* =====================================================
           PAYMENT GUIDE MODAL
        ===================================================== */
        .pay-modal-overlay {
            position:fixed; inset:0; background:rgba(0,0,0,.55);
            backdrop-filter:blur(6px); -webkit-backdrop-filter:blur(6px);
            z-index:400; opacity:0; pointer-events:none;
            transition:opacity .35s var(--ease);
            visibility:hidden;
        }
        .pay-modal-overlay.active { opacity:1; pointer-events:all; visibility:visible; }
        .pay-modal {
            position:fixed; top:50%; left:50%;
            transform:translate(-50%,-44%) scale(.92);
            background:var(--surface); border-radius:var(--radius-xl);
            width:92%; max-width:480px; max-height:88vh;
            overflow:hidden; display:flex; flex-direction:column;
            z-index:401; box-shadow:var(--shadow-lg);
            transition:transform .45s var(--ease-spring), opacity .35s var(--ease);
            border:1px solid var(--border);
            padding:0; opacity:0;
            visibility:hidden; pointer-events:none;
        }
        .pay-modal.active { transform:translate(-50%,-50%) scale(1); opacity:1; visibility:visible; pointer-events:auto; }
        .pay-modal-header {
            padding:20px 24px 16px; border-bottom:1px solid var(--border);
            display:flex; align-items:center; justify-content:space-between;
            position:sticky; top:0; background:var(--surface); z-index:1;
            border-radius:var(--radius-xl) var(--radius-xl) 0 0;
        }
        .pay-modal-header h3 { margin:0; font-size:1em; font-family:'Space Grotesk',sans-serif; font-weight:700; display:flex; align-items:center; gap:8px; color:var(--text-primary); }
        .pay-modal-close { background:var(--surface-2); border:1px solid var(--border); width:30px; height:30px; border-radius:50%; cursor:pointer; color:var(--text-muted); display:flex; align-items:center; justify-content:center; font-size:.88em; transition:all .2s; }
        .pay-modal-close:hover { background:var(--accent-red); border-color:var(--accent-red); color:#fff; }
        .pay-modal-body {
            padding:20px 24px 28px; overflow-y:auto; flex:1;
            scrollbar-width:thin; scrollbar-color:var(--border-strong) transparent;
        }
        .pay-modal-body::-webkit-scrollbar { width:4px; }
        .pay-modal-body::-webkit-scrollbar-track { background:transparent; }
        .pay-modal-body::-webkit-scrollbar-thumb { background:var(--border-strong); border-radius:10px; }
        .pay-step { display:flex; gap:14px; margin-bottom:20px; align-items:flex-start; }
        .pay-step-num {
            width:28px; height:28px; border-radius:50%;
            background:var(--accent-green); color:#000;
            font-weight:700; font-size:.8em; font-family:'Space Grotesk',sans-serif;
            display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-top:1px;
        }
        .pay-step-content { flex:1; }
        .pay-step-content p { margin:0; font-size:.86em; color:var(--text-secondary); line-height:1.65; }
        .pay-step-content strong { font-weight:700; color:var(--text-primary); }
        .pay-qr-wrap { background:var(--surface-2); border:1px solid var(--border); border-radius:var(--radius-md); padding:18px; text-align:center; margin:8px 0 10px; }
        .pay-qr-wrap img { width:180px; height:180px; object-fit:cover; border-radius:10px; display:block; margin:0 auto 12px; }
        .pay-kbz-info { background:var(--text-primary); color:var(--surface); border-radius:var(--radius-sm); padding:14px 18px; display:flex; flex-direction:column; align-items:flex-start; gap:4px; width:100%; }
        .pay-kbz-info .kbz-label { font-size:.66em; color:var(--accent-green); font-weight:700; letter-spacing:.07em; text-transform:uppercase; }
        .pay-kbz-info .kbz-value { font-size:.96em; font-weight:700; font-family:'Space Grotesk',sans-serif; letter-spacing:.02em; }
        .pay-divider { height:1px; background:var(--border); margin:18px 0; }
        .pay-upload-area {
            border:2px dashed var(--border-strong); border-radius:var(--radius-md);
            padding:22px; text-align:center; cursor:pointer;
            transition:all .25s var(--ease); position:relative; background:var(--surface-2);
        }
        .pay-upload-area:hover { border-color:var(--accent-green); background:var(--green-subtle); }
        .pay-upload-area.has-file { border-color:var(--accent-green); background:var(--green-subtle); }
        .pay-upload-area input { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
        .pay-upload-area i { font-size:1.6em; color:var(--text-muted); margin-bottom:8px; display:block; }
        .pay-upload-area.has-file i { color:var(--accent-green); }
        .pay-upload-area p { margin:0; font-size:.8em; color:var(--text-muted); line-height:1.6; }
        .pay-upload-area.has-file p { color:#2d8a50; font-weight:600; }
        [data-theme="dark"] .pay-upload-area.has-file p { color:var(--accent-green); }
        .pay-preview-img { width:100%; max-height:140px; object-fit:contain; border-radius:8px; margin-top:10px; display:none; }
        .pay-preview-img.show { display:block; }
        .pay-submit-btn {
            display:flex; align-items:center; justify-content:center; gap:8px;
            width:100%; padding:13px 20px; border-radius:50px;
            background:var(--accent-green); color:#000;
            font-weight:700; font-size:.86em; font-family:'Poppins',sans-serif;
            border:none; cursor:pointer; transition:all .3s var(--ease); margin-top:14px;
            box-shadow:0 2px 10px rgba(167,225,105,.25);
        }
        .pay-submit-btn:hover { background:#96d158; transform:translateY(-1px); box-shadow:0 4px 16px rgba(167,225,105,.35); }
        .pay-submit-btn:active { transform:scale(.97); }
        .pay-submit-btn:disabled { opacity:.5; cursor:not-allowed; transform:none; }
        .pay-success-box { text-align:center; padding:20px 0 8px; }
        .pay-success-box .success-emoji { font-size:2.4em; display:block; margin-bottom:10px; }
        .pay-success-box h4 { font-family:'Space Grotesk',sans-serif; font-size:1.1em; margin:0 0 6px; color:var(--text-primary); }
        .pay-success-box p { font-size:.84em; color:var(--text-secondary); line-height:1.6; margin:0; }

        /* =====================================================
           COURSE PLAYER
        ===================================================== */
        .course-player-wrap { max-width:900px; margin:0 auto; }
        .back-btn { background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:.88em; margin-bottom:16px; display:flex; align-items:center; gap:6px; font-family:'Poppins',sans-serif; padding:0; transition:color .2s; }
        .back-btn:hover { color:var(--text-primary); }
        .video-container { background:#000; border-radius:var(--radius-md); overflow:hidden; aspect-ratio:16/9; margin-bottom:20px; box-shadow:var(--shadow-md); }
        .video-container iframe { width:100%; height:100%; border:none; }
        .materials-section { background:var(--surface); border:1px solid var(--border); border-radius:var(--radius-md); padding:20px 24px; margin-bottom:20px; }
        .materials-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
        .materials-header h3 { margin:0; font-size:.98em; display:flex; align-items:center; gap:8px; font-family:'Space Grotesk',sans-serif; color:var(--text-primary); }
        .mat-count-badge { background:rgba(2,132,199,.1); color:#0284c7; font-size:.7em; padding:2px 8px; border-radius:10px; font-weight:600; }
        .download-all-btn { background:var(--text-primary); color:var(--accent-green); border:none; padding:7px 16px; border-radius:8px; font-size:.76em; cursor:pointer; font-weight:600; display:flex; align-items:center; gap:6px; font-family:'Poppins',sans-serif; transition:all .2s var(--ease); }
        .download-all-btn:hover { opacity:.85; transform:scale(1.03); }
        .material-download-card { display:flex; align-items:center; gap:12px; padding:12px 14px; background:var(--surface-2); border:1px solid var(--border); border-radius:var(--radius-sm); margin-bottom:8px; transition:all .2s var(--ease); }
        .material-download-card:hover { border-color:var(--accent-green); transform:translateY(-1px); box-shadow:var(--shadow-xs); }
        .mat-icon { width:44px; height:44px; border-radius:var(--radius-sm); display:flex; align-items:center; justify-content:center; flex-shrink:0; }
        .mat-icon.pdf{background:#fef2f2;color:#dc2626}.mat-icon.zip{background:#fefce8;color:#ca8a04}.mat-icon.doc{background:#eff6ff;color:#2563eb}.mat-icon.xls{background:#f0fdf4;color:#16a34a}.mat-icon.ppt{background:#fdf4ff;color:#c026d3}.mat-icon.png,.mat-icon.jpg{background:#ecfeff;color:#0891b2}.mat-icon.mp3{background:#fdf2f8;color:#db2777}.mat-icon.mp4{background:#fff7ed;color:#ea580c}.mat-icon.code{background:#f5f3ff;color:#7c3aed}.mat-icon.other{background:#f3f4f6;color:#6b7280}
        .mat-icon svg { width:20px; height:20px; }
        .mat-details { flex:1; min-width:0; }
        .mat-details .mat-name { font-weight:600; font-size:.86em; margin:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:var(--text-primary); }
        .mat-details .mat-meta { font-size:.7em; color:var(--text-muted); margin-top:2px; }
        .mat-download-btn { background:var(--text-primary); color:var(--surface); border:none; padding:8px 16px; border-radius:8px; font-size:.76em; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px; transition:all .2s var(--ease); flex-shrink:0; font-family:'Poppins',sans-serif; }
        .mat-download-btn:hover { background:var(--accent-green); color:#000; transform:scale(1.03); }
        .lessons-sidebar { background:var(--surface); border:1px solid var(--border); border-radius:var(--radius-md); padding:20px 24px; }
        .lessons-sidebar h3 { margin:0 0 14px; font-size:.98em; font-family:'Space Grotesk',sans-serif; display:flex; align-items:center; gap:8px; color:var(--text-primary); }
        .lesson-list-item { display:flex; align-items:center; gap:12px; padding:12px; border-radius:var(--radius-sm); cursor:pointer; transition:all .2s var(--ease); margin-bottom:4px; border:1px solid transparent; }
        .lesson-list-item:hover { background:var(--surface-2); }
        .lesson-list-item.active { background:var(--green-subtle); border-color:rgba(167,225,105,.3); }
        .lesson-idx { width:30px; height:30px; border-radius:8px; background:var(--border); display:flex; align-items:center; justify-content:center; font-family:'Space Grotesk',monospace; font-weight:700; font-size:.8em; flex-shrink:0; color:var(--text-primary); }
        .lesson-list-item.active .lesson-idx { background:var(--text-primary); color:var(--accent-green); }
        .lesson-title-text { flex:1; font-size:.84em; font-weight:500; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:var(--text-primary); }
        .lesson-duration { font-size:.7em; color:var(--text-muted); flex-shrink:0; }
        .lesson-mat-badge { background:rgba(29,78,216,.1); color:#1d4ed8; font-size:.67em; padding:2px 7px; border-radius:6px; flex-shrink:0; font-weight:600; display:inline-flex; align-items:center; gap:3px; }

        /* =====================================================
           RESPONSIVE
        ===================================================== */
        @media(max-width:992px) {
            .product-grid { grid-template-columns:repeat(2,1fr); }
        }

        @media(max-width:768px) {
            .welcome-header { flex-direction:column; align-items:flex-start; gap:12px; }
            .nav-container { height:56px; padding:0 16px; }
            .nav-logo img { height:24px; }
            .btn { padding:7px 13px; font-size:.76em; }
            .btn-refresh span, .btn-logout span { display:none; }
            .container { padding:20px 16px; }
        }

        @media(max-width:600px) {
            .product-grid { grid-template-columns:1fr; gap:14px; }
            .login-section { flex-direction:column; }
            .login-left { flex:none; height:30vh; min-height:180px; }
            .login-right { flex:1; padding:28px 20px; }
            .login-card { max-width:100%; }
            .login-card h2 { font-size:1.3em; }
            .go-to-shop-btn { bottom:14px; left:14px; padding:8px 16px; font-size:.74em; }
            .cart-slidein, .profile-slidein { width:100%; max-width:100%; }
            .btn-profile span { display:none; }
            .btn-profile { padding:7px 11px; }
            .btn-refresh { padding:7px 11px; }
            .btn-refresh span { display:none; }
            .welcome-header { padding:22px 20px; border-radius:var(--radius-lg); flex-wrap:wrap; }
            .welcome-header h1 { font-size:1.2em; }
            .btn-back-shop { width:100%; justify-content:center; margin-top:4px; }
            .thank-you-letter { padding:20px; }
            .thank-you-letter p { font-size:.84em; }
            .empty-state { padding:48px 20px; }
            .pay-modal { width:96%; max-width:100%; max-height:92vh; border-radius:var(--radius-md); }
            .pay-modal-body { padding:16px 18px 24px; }
            .pay-modal-header { padding:16px 18px 12px; }
            .pay-qr-wrap img { width:150px; height:150px; }
            .section-title { font-size:1.05em; }
            .badge { position:static; display:inline-flex; margin-top:8px; }
            .material-download-card { flex-wrap:wrap; }
            .mat-download-btn { width:100%; justify-content:center; }
            .pending-notice { flex-direction:column; align-items:flex-start; }
        }

        @media(max-width:380px) {
            .nav-actions { gap:4px; }
            .btn { padding:6px 10px; font-size:.72em; }
            .theme-toggle-float { bottom:1.2rem; right:1.2rem; width:2.6rem; height:2.6rem; }
        }

        @media(hover:none) {
            .product-card:hover { transform:none; box-shadow:var(--shadow-xs); }
            .product-card:hover .thumb { transform:none; }
            .btn-download:hover { transform:none; }
        }
    </style>
</head>
<body>

    <!-- ========== LOGIN SECTION ========== -->
    <div id="loginSection" class="login-section">
        <div class="login-left">
            <video autoplay muted loop playsinline>
                <source src="https://res.cloudinary.com/ddkd9lxpr/video/upload/v1771041087/thank-you_olmg32.mp4" type="video/mp4">
            </video>
            <div class="login-left-overlay"></div>
            <div class="login-left-content">
                <p class="login-left-tagline">ART de ONE</p>
                <h2 class="login-left-title">Your Creative<br><span>Assets Hub</span></h2>
            </div>
            <a href="shop.html" class="go-to-shop-btn"><i class="fas fa-store"></i> Go to Shop</a>
        </div>
        <div class="login-right">
            <div class="login-card" id="loginCard">
                <div class="logo-wrap">
                    <img src="https://res.cloudinary.com/ddkd9lxpr/image/upload/v1768125759/logo-green_wzaqzh.png" alt="ART de ONE">
                </div>
                <h2>Customer Dashboard</h2>
                <p class="login-subtitle">Login ၀င်ပြီး Products များကို ရယူပါ</p>

                <!-- LOGIN FORM -->
                <div id="loginFormView">
                    <button onclick="loginWithGoogle()" class="login-google-btn grain-btn" id="googleBtn">
                        <svg viewBox="0 0 24 24" width="22" height="22"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                        <span class="btn-text">Sign in with Google</span>
                        <span class="btn-loading"><i class="fas fa-spinner fa-spin"></i> Connecting...</span>
                    </button>
                    <div class="login-divider">or</div>
                    <div class="auth-form-group">
                        <input type="email" id="loginEmail" class="auth-input" placeholder="Email">
                    </div>
                    <div class="auth-form-group">
                        <input type="password" id="loginPassword" class="auth-input" placeholder="Password">
                    </div>
                    <button onclick="loginWithEmail()" class="login-signin-btn grain-btn" id="emailLoginBtn">
                        <span class="btn-text">Sign In</span>
                        <span class="btn-loading"><i class="fas fa-spinner fa-spin"></i> Signing in...</span>
                    </button>
                    <div class="auth-links">
                        <button onclick="showForgotWithLoading()" class="auth-link">Forgot password?</button>
                        <button onclick="showRegisterWithLoading()" class="auth-link auth-link-create">Create account</button>
                    </div>
                </div>

                <!-- REGISTER FORM -->
                <div id="registerFormView" style="display:none;">
                    <div class="auth-form-group"><input type="text" id="regName" class="auth-input" placeholder="Full Name"></div>
                    <div class="auth-form-group"><input type="email" id="regEmail" class="auth-input" placeholder="Email"></div>
                    <div class="auth-form-group"><input type="password" id="regPassword" class="auth-input" placeholder="Password"></div>
                    <p class="password-hint"><i class="fas fa-info-circle"></i> Password အနည်းဆုံး ၆ လုံး ထည့်ပါ</p>
                    <button onclick="registerWithEmail()" class="login-create-btn grain-btn" id="emailRegBtn">
                        <span class="btn-text">Create Account</span>
                        <span class="btn-loading"><i class="fas fa-spinner fa-spin"></i> Creating...</span>
                    </button>
                    <div style="margin-top:10px;"><button onclick="showLogin()" class="login-back-btn">Back to Login</button></div>
                </div>

                <!-- FORGOT PASSWORD -->
                <div id="forgotPasswordView" style="display:none;">
                    <p style="text-align:center;color:var(--text-muted);font-size:.84em;margin-bottom:16px;line-height:1.6;">Email ထည့်ပြီး Password Reset Link ရယူပါ</p>
                    <div class="auth-form-group"><input type="email" id="resetEmail" class="auth-input" placeholder="Email"></div>
                    <button onclick="sendResetLink()" class="login-signin-btn grain-btn" id="resetBtn">
                        <span class="btn-text">Send Reset Link</span>
                        <span class="btn-loading"><i class="fas fa-spinner fa-spin"></i> Sending...</span>
                    </button>
                    <div style="margin-top:10px;"><button onclick="showLogin()" class="login-back-btn">Back to Login</button></div>
                </div>

                <!-- SUCCESS -->
                <div id="authSuccessView" style="display:none;">
                    <div class="auth-success-box">
                        <span class="success-icon">&#x2709;&#xFE0F;</span>
                        <h3 id="authSuccessTitle">Email ပို့ပြီးပါပြီ!</h3>
                        <p id="authSuccessText"></p>
                    </div>
                    <button onclick="showLogin()" class="login-back-btn">Back to Login</button>
                </div>

                <p class="login-error" id="loginError">Login မအောင်မြင်ပါ။</p>
                <div class="login-loading-state" id="loginLoading">
                    <div class="spinner"></div>
                    <p>Verifying your account...</p>
                </div>

                <!-- TRUST BADGES -->
                <div class="trust-badges">
                    <span class="trust-badge-item"><i class="fas fa-lock tb-ssl"></i> SSL Secured</span>
                    <span class="trust-badge-item"><i class="fas fa-shield-alt tb-dmca"></i> DMCA.com</span>
                    <span class="trust-badge-item"><i class="fas fa-check-circle tb-verified"></i> Verified Professional</span>
                    <span class="trust-badge-item"><i class="fas fa-user-shield tb-safe"></i> Google Safe</span>
                    <a href="https://g.page/r/Cb6j-IdtRRWLEAE/review" target="_blank" class="trust-badge-item" style="text-decoration:none;cursor:pointer"><i class="fa-brands fa-google" style="color:#4285F4"></i> Google Business</a>
                </div>

                <div style="margin-top:22px;padding-top:18px;border-top:1px solid var(--border);text-align:center;font-size:.76em;color:var(--text-muted);line-height:1.8;">
                    Contact : <a href="/cdn-cgi/l/email-protection#2e4f5c5a4a4b41404b004b4a5b4d4f5a415c5d6e49434f4742004d4143" style="color:var(--text-primary);font-weight:600;text-decoration:none;"><span class="__cf_email__" data-cfemail="a3c2d1d7c7c6cccdc68dc6c7d6c0c2d7ccd1d0e3c4cec2cacf8dc0ccce">[email&#160;protected]</span></a>
                    <br>Support phone : <a href="tel:09953681497" style="color:var(--text-primary);font-weight:600;text-decoration:none;">09 953 681 497</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== DASHBOARD ========== -->
    <div id="dashboardSection" class="hidden">
        <nav class="top-nav" id="topNav">
            <div class="nav-container">
                <div class="nav-logo">
                    <img src="https://res.cloudinary.com/ddkd9lxpr/image/upload/v1768125759/logo-green_wzaqzh.png" alt="ART de ONE" id="navLogoImg">
                </div>
                <div class="nav-actions">
                    <button onclick="toggleProfile()" class="btn btn-profile" id="profileBtn">
                        <span class="profile-avatar-sm" id="navAvatarInitial"></span>
                        <span>Profile</span>
                    </button>
                    <button onclick="toggleCart()" class="btn btn-cart" id="cartBtn">
                        <i class="fas fa-shopping-bag"></i>
                        <span class="cart-count hidden-count" id="cartCount">0</span>
                    </button>
                    <button onclick="refreshDashboard()" class="btn btn-refresh">
                        <i class="fas fa-rotate-right"></i> <span>Refresh</span>
                    </button>
                    <button onclick="logout()" class="btn btn-logout">Logout</button>
                </div>
            </div>
        </nav>

        <div class="container">
            <!-- Welcome Header -->
            <div class="welcome-header">
                <div class="org-blob org-blob-1"></div>
                <div class="org-blob org-blob-2"></div>
                <div class="org-blob org-blob-3"></div>
                <div class="welcome-avatar-wrap-main">
                    <div class="avatar-ring" id="welcomeAvatarWrap"></div>
                </div>
                <div class="welcome-text-wrap">
                    <h1 id="customerName">Welcome</h1>
                    <p class="email-text" id="customerEmail"></p>
                    <span class="badge">Shop Customer</span>
                </div>
                <button onclick="openPayGuide()" class="btn-back-shop grain-btn">
                    <svg viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" style="width:14px;height:14px;flex-shrink:0;"><rect x="1" y="3" width="12" height="8" rx="1.5" stroke="currentColor" stroke-width="1.4"/><path d="M1 6h12" stroke="currentColor" stroke-width="1.4"/><circle cx="4" cy="9" r="0.7" fill="currentColor"/><circle cx="6.5" cy="9" r="0.7" fill="currentColor"/></svg>
                    Product ဝယ်ရန်လမ်းညွှန်
                </button>
            </div>

            <!-- Thank You Letter -->
            <div class="thank-you-letter" id="thankYouLetter">
                <div class="letter-icon">&#x1F49C;</div>
                <p id="thankYouText"></p>
            </div>

            <div id="myProductsSection">
                <h2 class="section-title"><i class="fas fa-box-open" style="color:var(--accent-green);font-size:.85em;"></i> My Products</h2>

                <!-- Pending Order Notice -->
                <div class="pending-notice" id="pendingNotice">
                    <div class="pending-notice-left">
                        <div class="pending-notice-icon">&#x23F3;</div>
                        <div class="pending-notice-text">
                            <strong>Pending Order ရှိနေပါသည်</strong>
                            <span>KBZ Pay ဖြင့် ငွေပေးချေပြီးပါက Screenshot ကို Admin ထံ ပေးပို့ပါ။<br>Admin က အတည်ပြုပြီးမှ Product ရယူနိုင်ပါမည်။</span>
                        </div>
                    </div>
                    <button class="pending-notice-btn grain-btn" onclick="openScreenshotUpload()">
                        <i class="fas fa-image"></i> Screenshot ပို့မည်
                    </button>
                </div>

                <div id="productsContainer"><div class="loading-spinner">Loading...</div></div>

                <div class="browse-section" id="browseSection" style="display:none;">
                    <h2 class="section-title" style="display:flex;align-items:center;gap:8px;margin-bottom:20px;">
                        <i class="fas fa-fire" style="color:var(--accent-red);font-size:.85em;"></i> Browse More Products
                    </h2>
                    <div id="browseContainer"></div>
                </div>
            </div>

            <div id="coursePlayerSection" class="hidden">
                <div class="course-player-wrap">
                    <button onclick="backToCourses()" class="back-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
                        Back to My Products
                    </button>
                    <div class="video-container" id="videoContainer">
                        <iframe id="courseVideoPlayer" allowfullscreen></iframe>
                    </div>
                    <div style="background:var(--surface);padding:22px 26px;border-radius:var(--radius-md);margin-bottom:20px;border:1px solid var(--border);box-shadow:var(--shadow-xs);">
                        <h2 id="currentLessonTitle" style="margin:0 0 4px;font-size:1.1em;font-family:'Space Grotesk',sans-serif;color:var(--text-primary);"></h2>
                        <p id="currentLessonDesc" style="margin:0;color:var(--text-secondary);font-size:.86em;line-height:1.6;"></p>
                    </div>
                    <div id="lessonMaterialsSection" class="materials-section" style="display:none;">
                        <div class="materials-header">
                            <h3><i class="fas fa-paperclip" style="font-size:.85em;"></i> Lesson Materials <span id="materialCount" class="mat-count-badge"></span></h3>
                            <button onclick="downloadAllMaterials()" id="downloadAllBtn" class="download-all-btn"><i class="fas fa-download" style="font-size:.85em;"></i> Download All</button>
                        </div>
                        <div id="materialsList"></div>
                    </div>
                    <div class="lessons-sidebar">
                        <h3><i class="fas fa-book-open" style="font-size:.85em;"></i> All Lessons</h3>
                        <div id="lessonsList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== PAYMENT GUIDE MODAL ===== -->
    <div class="pay-modal-overlay" id="payGuideOverlay" onclick="closePayGuide()"></div>
    <div class="pay-modal" id="payGuideModal">
        <div class="pay-modal-header">
            <h3><i class="fas fa-wallet" style="color:var(--accent-green);"></i> Product ဝယ်ရန်လမ်းညွှန်</h3>
            <button class="pay-modal-close" onclick="closePayGuide()">✕</button>
        </div>
        <div class="pay-modal-body" id="payGuideBody">
            <div class="pay-step">
                <div class="pay-step-num">1</div>
                <div class="pay-step-content">
                    <p><strong>Cart ထည့်ပါ</strong><br>ဝယ်ချင်သော product ၏ <strong>Buy</strong> ခလုတ်နှိပ်၍ Cart ထဲသို့ ထည့်ပါ၊ ထို့နောက် <strong>Order</strong> ခလုတ်နှိပ်ပါ။</p>
                </div>
            </div>
            <div class="pay-step">
                <div class="pay-step-num">2</div>
                <div class="pay-step-content">
                    <p><strong>KBZ Pay ဖြင့် ငွေပေးချေပါ</strong><br>အောက်ဖော်ပြပါ QR Code ကို KBZ Pay App မှ Scan ပြုလုပ်၍ ငွေပေးချေပါ။</p>
                    <div class="pay-qr-wrap">
                        <img src="https://res.cloudinary.com/ddkd9lxpr/image/upload/v1772078379/kbz-pay_fwm6be.jpg" alt="KBZ Pay QR" onerror="this.src='https://placehold.co/180x180?text=QR+Code'">
                        <div class="pay-kbz-info">
                            <span class="kbz-label">KBZ Pay Number</span>
                            <span class="kbz-value">09 953 681 497</span>
                            <span class="kbz-label" style="margin-top:6px;">Name</span>
                            <span class="kbz-value">Phyo Min Zaw</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pay-step">
                <div class="pay-step-num">3</div>
                <div class="pay-step-content">
                    <p><strong>Screenshot ရိုက်ပြီး Admin ထံ ပေးပို့ပါ</strong><br>ငွေပေးချေပြီးပါက KBZ Pay payment screenshot ကို ဒီမှာ Upload လုပ်ပြီး Admin ထံ ပေးပို့ပါ။</p>
                    <div class="pay-divider"></div>
                    <div class="pay-upload-area" id="payUploadArea" onclick="document.getElementById('payScreenshotFile').click()">
                        <input type="file" id="payScreenshotFile" accept="image/*" onchange="handleScreenshotSelect(event)" style="display:none">
                        <i class="fas fa-cloud-upload-alt" id="payUploadIcon"></i>
                        <p id="payUploadText">Screenshot ကို ဒီနေရာတွင် နှိပ်၍ Upload လုပ်ပါ<br><span style="font-size:.9em;opacity:.7;">JPG, PNG — Max 5MB</span></p>
                        <img id="payPreviewImg" class="pay-preview-img" alt="Preview">
                    </div>
                    <button class="pay-submit-btn grain-btn" id="paySubmitBtn" onclick="submitPaymentScreenshot()" disabled>
                        <i class="fas fa-paper-plane"></i> Admin ထံ ပေးပို့မည်
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== CART ===== -->
    <div class="cart-overlay" id="cartOverlay" onclick="closeCart()"></div>
    <div class="cart-slidein" id="cartSlidein">
        <div class="cart-header">
            <h3><i class="fas fa-shopping-bag" style="color:var(--accent-red);"></i>Cart</h3>
            <button onclick="closeCart()">&#x2715;</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="cart-empty"><i class="fas fa-shopping-bag"></i><p style="font-size:.84em;">Your cart is empty</p></div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span class="cart-total-label">Total</span>
                <span class="cart-total-value" id="cartTotal">0 MMK</span>
            </div>
            <button onclick="placeOrder()" class="btn btn-order" id="orderBtn"><i class="fas fa-paper-plane" style="margin-right:6px;"></i>Order</button>
            <button onclick="closeCart()" class="btn btn-cancel-cart">Cancel</button>
        </div>
    </div>

    <!-- ===== PROFILE ===== -->
    <div class="profile-overlay" id="profileOverlay" onclick="closeProfile()"></div>
    <div class="profile-slidein" id="profileSlidein">
        <div class="profile-header">
            <div class="profile-header-top">
                <h3><i class="fas fa-user-circle" style="color:var(--accent-green);"></i> My Profile</h3>
                <button onclick="closeProfile()">&#x2715;</button>
            </div>
            <div class="profile-avatar-wrap">
                <div class="profile-avatar" id="profileAvatar"></div>
                <div class="profile-name" id="profileName"></div>
                <span class="profile-status">Active</span>
            </div>
        </div>
        <div class="profile-content">
            <div class="profile-stats" id="profileStats">
                <div class="profile-stat-card"><div class="stat-value" id="statProducts">0</div><div class="stat-label">Products</div></div>
                <div class="profile-stat-card"><div class="stat-value" id="statOrders">0</div><div class="stat-label">Orders</div></div>
            </div>
            <div class="profile-info-section">
                <div class="profile-info-label">Account Information</div>
                <div class="profile-info-card">
                    <div class="profile-info-row"><div class="info-icon email-icon"><i class="fas fa-envelope"></i></div><div class="info-detail"><div class="info-title">Email</div><div class="info-value" id="profileEmail">-</div></div></div>
                    <div class="profile-info-row"><div class="info-icon phone-icon"><i class="fas fa-phone"></i></div><div class="info-detail"><div class="info-title">Phone</div><div class="info-value" id="profilePhone">-</div></div></div>
                    <div class="profile-info-row"><div class="info-icon date-icon"><i class="fas fa-calendar-alt"></i></div><div class="info-detail"><div class="info-title">Member Since</div><div class="info-value" id="profileDate">-</div></div></div>
                    <div class="profile-info-row"><div class="info-icon method-icon" id="loginMethodIcon"><i class="fab fa-google"></i></div><div class="info-detail"><div class="info-title">Login Method</div><div class="info-value" id="loginMethodValue">Google Account</div></div></div>
                </div>
            </div>
            <div class="profile-orders-section">
                <div class="profile-info-label">Order History</div>
                <div id="profileOrdersList"><div class="profile-orders-empty"><i class="fas fa-receipt"></i><p>No orders yet</p></div></div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"><i class="fas fa-check-circle"></i><span id="toastMsg">Done!</span></div>

    <!-- Floating Dark Mode Toggle -->
    <button id="themeToggleBtn" class="theme-toggle-float" onclick="toggleTheme()" title="Toggle Dark Mode">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <!-- Dark Mode Toggle Script (inline, runs before module) -->
    <script>
        (function(){
            const saved = localStorage.getItem('ado-theme') || 'light';
            document.documentElement.setAttribute('data-theme', saved);
            const icon = document.getElementById('themeIcon');
            if(icon) icon.className = saved === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            const logo = document.getElementById('navLogoImg');
            if(logo && saved === 'dark') logo.src = 'https://res.cloudinary.com/ddkd9lxpr/image/upload/v1768125759/logo-green_wzaqzh.png';
        })();
        window.toggleTheme = function() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme') || 'light';
            const next = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', next);
            localStorage.setItem('ado-theme', next);
            const icon = document.getElementById('themeIcon');
            if(icon) icon.className = next === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        };
    </script>

    <!-- ========== ORIGINAL JS (UNCHANGED) ========== -->
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="module">
    import { supabaseShop, PRODUCT_CATEGORIES, signInWithGoogle, signOutCustomer, getAuthSession, onAuthChange, findOrCreateCustomer, signUpWithEmail, signInWithEmail, resetPassword } from './js/config-shop.js';

    let currentCustomer = null, allProducts = [], purchasedProductIds = [], cart = [];
    const FILE_SVG = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Z"/><path d="M14 2v6h6"/></svg>`;

    window.addEventListener('scroll', () => { const n = document.getElementById('topNav'); if (n) n.classList.toggle('scrolled', window.scrollY > 8); }, { passive: true });

    // ========== VIEW TOGGLES ==========
    function hideAllAuthViews() {
        ['loginFormView','registerFormView','forgotPasswordView','authSuccessView'].forEach(id => { const e = document.getElementById(id); if (e) e.style.display = 'none'; });
        document.getElementById('loginError').style.display = 'none';
    }
    function animateAuthView(el) { el.classList.remove('auth-view-animate'); void el.offsetHeight; el.classList.add('auth-view-animate'); }
    window.showLogin = () => { hideAllAuthViews(); const v = document.getElementById('loginFormView'); v.style.display = 'block'; animateAuthView(v); document.querySelector('.login-card h2').textContent = 'Customer Dashboard'; document.querySelector('.login-subtitle').textContent = 'Login ၀င်ပြီး Products များကို ရယူပါ'; };
    window.showRegister = () => { hideAllAuthViews(); const v = document.getElementById('registerFormView'); v.style.display = 'block'; animateAuthView(v); document.querySelector('.login-card h2').textContent = 'Create Account'; document.querySelector('.login-subtitle').textContent = 'အကောင့်အသစ် ဖန်တီးပါ'; };
    window.showForgotPassword = () => { hideAllAuthViews(); const v = document.getElementById('forgotPasswordView'); v.style.display = 'block'; animateAuthView(v); document.querySelector('.login-card h2').textContent = 'Reset Password'; document.querySelector('.login-subtitle').textContent = 'Password မေ့နေပါသလား?'; };

    window.showRegisterWithLoading = () => { hideAllAuthViews(); document.getElementById('loginLoading').style.display = 'block'; setTimeout(() => { document.getElementById('loginLoading').style.display = 'none'; showRegister(); }, 2000); };
    window.showForgotWithLoading = () => { hideAllAuthViews(); document.getElementById('loginLoading').style.display = 'block'; setTimeout(() => { document.getElementById('loginLoading').style.display = 'none'; showForgotPassword(); }, 2000); };
    function showAuthSuccess(t, m) { hideAllAuthViews(); document.getElementById('authSuccessView').style.display = 'block'; document.getElementById('authSuccessTitle').textContent = t; document.getElementById('authSuccessText').textContent = m; document.querySelector('.login-card h2').textContent = t; document.querySelector('.login-subtitle').textContent = ''; }

    // ========== EMAIL AUTH ==========
    window.loginWithEmail = async () => {
        const email = document.getElementById('loginEmail').value.trim(), password = document.getElementById('loginPassword').value;
        const btn = document.getElementById('emailLoginBtn'), err = document.getElementById('loginError');
        if (!email || !password) { err.textContent = 'Email နှင့် Password ထည့်ပေးပါ'; err.style.display = 'block'; return; }
        btn.classList.add('loading'); btn.disabled = true; err.style.display = 'none';
        const { data, error } = await signInWithEmail(email, password);
        btn.classList.remove('loading'); btn.disabled = false;
        if (error) {
            err.textContent = error.message.includes('Invalid login') ? 'Email သို့မဟုတ် Password မှားနေပါတယ်' : error.message.includes('Email not confirmed') ? 'Email ကို အတည်ပြုပေးပါ။ Inbox စစ်ပါ။' : error.message;
            err.style.display = 'block'; err.style.animation = 'none'; err.offsetHeight; err.style.animation = 'errorShake .4s var(--ease)'; return;
        }
        showLoginLoading();
        if (data?.session?.user) await initDashboard(data.session.user);
    };

    window.registerWithEmail = async () => {
        const name = document.getElementById('regName').value.trim(), email = document.getElementById('regEmail').value.trim(), password = document.getElementById('regPassword').value;
        const btn = document.getElementById('emailRegBtn'), err = document.getElementById('loginError');
        if (!name || !email || !password) { err.textContent = 'အချက်အလက်အားလုံး ဖြည့်ပေးပါ'; err.style.display = 'block'; return; }
        if (password.length < 6) { err.textContent = 'Password အနည်းဆုံး ၆ လုံး ထည့်ပေးပါ'; err.style.display = 'block'; return; }
        btn.classList.add('loading'); btn.disabled = true; err.style.display = 'none';
        const { data, error } = await signUpWithEmail(email, password, name);
        btn.classList.remove('loading'); btn.disabled = false;
        if (error) { err.textContent = error.message.includes('already registered') ? 'ဒီ Email ကို အသုံးပြုပြီးသားဖြစ်ပါတယ်။ Login ၀င်ပါ။' : error.message; err.style.display = 'block'; return; }
        showAuthSuccess('Confirmation Email ပို့ပြီးပါပြီ!', `${email} ကို Confirmation Link ပို့ပေးပါပြီ။ Email Inbox (သို့) Spam folder ကို စစ်ပြီး Link ကို နှိပ်ပေးပါ။`);
    };

    window.sendResetLink = async () => {
        const email = document.getElementById('resetEmail').value.trim(), btn = document.getElementById('resetBtn'), err = document.getElementById('loginError');
        if (!email) { err.textContent = 'Email ထည့်ပေးပါ'; err.style.display = 'block'; return; }
        btn.classList.add('loading'); btn.disabled = true; err.style.display = 'none';
        const { error } = await resetPassword(email);
        btn.classList.remove('loading'); btn.disabled = false;
        if (error) { err.textContent = error.message; err.style.display = 'block'; return; }
        showAuthSuccess('Reset Link ပို့ပြီးပါပြီ!', `${email} ကို Password Reset Link ပို့ပေးပါပြီ။ Email Inbox စစ်ပါ။`);
    };

    document.addEventListener('keydown', (e) => {
        if (e.key !== 'Enter') return;
        const lv = document.getElementById('loginFormView'), rv = document.getElementById('registerFormView'), fv = document.getElementById('forgotPasswordView');
        if (lv && lv.style.display !== 'none' && lv.style.display !== '') { if ([document.getElementById('loginEmail'), document.getElementById('loginPassword')].includes(document.activeElement)) loginWithEmail(); }
        if (rv && rv.style.display === 'block') { if (['regName','regEmail','regPassword'].some(f => document.activeElement === document.getElementById(f))) registerWithEmail(); }
        if (fv && fv.style.display === 'block') { if (document.activeElement === document.getElementById('resetEmail')) sendResetLink(); }
    });

    // ========== GOOGLE AUTH ==========
    window.loginWithGoogle = async () => {
        const btn = document.getElementById('googleBtn'); btn.classList.add('loading'); btn.disabled = true;
        const { error } = await signInWithGoogle();
        if (error) { btn.classList.remove('loading'); btn.disabled = false; document.getElementById('loginError').textContent = 'Google Login မအောင်မြင်ပါ။'; document.getElementById('loginError').style.display = 'block'; }
    };

    let initInProgress = false;

    // Auth initialization — only use INITIAL_SESSION (fires when Supabase client is fully ready)
    // Email login calls initDashboard directly after signInWithEmail succeeds
    onAuthChange(async (event, session) => {
        if (event === 'INITIAL_SESSION' && session?.user && !currentCustomer && !initInProgress) {
            showLoginLoading();
            await initDashboard(session.user);
        }
    });

    let loginLoadingTimer = null;
    function showLoginLoading() {
        ['loginFormView','registerFormView','forgotPasswordView','authSuccessView'].forEach(id => { const e = document.getElementById(id); if (e) e.style.display = 'none'; });
        document.getElementById('loginError').style.display = 'none';
        document.getElementById('loginLoading').style.display = 'block';
        clearTimeout(loginLoadingTimer);
        loginLoadingTimer = setTimeout(() => { if (document.getElementById('loginLoading').style.display === 'block' && !currentCustomer) { document.getElementById('loginLoading').style.display = 'none'; showLogin(); const e = document.getElementById('loginError'); e.textContent = 'Connection timed out. Please try again.'; e.style.display = 'block'; signOutCustomer(); } }, 45000);
    }

    async function initDashboard(authUser) {
        initInProgress = true;
        try {
            currentCustomer = await findOrCreateCustomer(authUser);
            clearTimeout(loginLoadingTimer);
            if (!currentCustomer || !currentCustomer.is_active) { document.getElementById('loginLoading').style.display = 'none'; showLogin(); document.getElementById('loginError').textContent = 'သင့်အကောင့်ကို ပိတ်ထားပါသည်။ Admin ကို ဆက်သွယ်ပါ။'; document.getElementById('loginError').style.display = 'block'; await signOutCustomer(); return; }
            currentCustomer._avatarUrl = authUser.user_metadata?.avatar_url || currentCustomer.avatar_url || null;
            const ls = document.getElementById('loginSection'); ls.style.transition = 'opacity .4s ease, transform .4s ease'; ls.style.opacity = '0'; ls.style.transform = 'scale(1.02)';
            setTimeout(() => { ls.style.display = 'none'; const d = document.getElementById('dashboardSection'); d.classList.remove('hidden'); d.classList.add('dashboard-enter'); renderHeader(); loadProducts(); }, 380);
        } catch (err) { initInProgress = false; document.getElementById('loginLoading').style.display = 'none'; showLogin(); document.getElementById('loginError').textContent = 'Error: ' + err.message; document.getElementById('loginError').style.display = 'block'; }
    }

    window.logout = async () => { await signOutCustomer(); location.reload(); };
    window.refreshDashboard = () => { if (currentCustomer) { const b = document.querySelector('.btn-refresh'); b.style.opacity = '.6'; b.textContent = '...'; loadProducts().then(() => { b.style.opacity = '1'; b.textContent = 'Refresh'; }); } };

    function getInitials(n) { return n.split(' ').map(w => w[0]).join('').toUpperCase().slice(0, 2); }
    function renderHeader() {
        document.getElementById('customerName').innerText = `Welcome, ${currentCustomer.name}`;
        document.getElementById('customerEmail').innerText = currentCustomer.email;
        const i = getInitials(currentCustomer.name), a = currentCustomer._avatarUrl;
        const nav = document.getElementById('navAvatarInitial'); if (a) nav.innerHTML = `<img src="${a}" alt="">`; else nav.textContent = i;
        const w = document.getElementById('welcomeAvatarWrap'); if (a) w.innerHTML = `<img src="${a}" alt="" style="width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid var(--accent-green);">`; else w.innerHTML = `<div class="avatar-fallback">${i}</div>`;
        typewriterHTML(document.getElementById('thankYouText'), `Dear <strong>${currentCustomer.name}</strong>,<br><br>ART de ONE ကို ယုံကြည်စိတ်ချစွာ ရွေးချယ်အသုံးပြုပေးတဲ့အတွက် အထူးကျေးဇူးတင်ရှိပါတယ်။ ${currentCustomer.name.split(' ')[0]} ရဲ့ လုပ်ငန်းတွေ၊ ဖန်တီးမှုတွေအတွက် ကျွန်တော်တို့ရဲ့ Products တွေက အကူအညီဖြစ်ပါစေလို့ ဆုမွန်ကောင်းတောင်းပါတယ်။ ဘာအခက်အခဲပဲ ရှိရှိ ကျွန်တော်တို့ကို အချိန်မရွေး ဆက်သွယ်နိုင်ပါတယ်နော်။<br><br>ချစ်ခင်လေးစားလျက်,<br><strong>ART de ONE Team</strong> 💚`);
    }

    function typewriterHTML(el, html, speed = 18) {
        el.innerHTML = '<span class="typewriter-cursor"></span>';
        const temp = document.createElement('div'); temp.innerHTML = html;
        const chars = []; 
        function extract(node) {
            if (node.nodeType === 3) { if (typeof Intl !== 'undefined' && Intl.Segmenter) { const seg = new Intl.Segmenter(undefined, { granularity: 'grapheme' }); for (const s of seg.segment(node.textContent)) chars.push({ type: 'char', ch: s.segment }); } else { for (const ch of node.textContent) chars.push({ type: 'char', ch }); } }
            else if (node.nodeName === 'BR') chars.push({ type: 'br' });
            else { chars.push({ type: 'open', tag: node.nodeName.toLowerCase(), node: node.cloneNode(false) }); node.childNodes.forEach(c => extract(c)); chars.push({ type: 'close' }); }
        }
        temp.childNodes.forEach(c => extract(c));
        let i = 0; const stack = [el];
        function tick() {
            if (i >= chars.length) { const cur = el.querySelector('.typewriter-cursor'); if (cur) setTimeout(() => cur.remove(), 1500); return; }
            const c = chars[i++], parent = stack[stack.length - 1];
            if (c.type === 'char') { const cur = el.querySelector('.typewriter-cursor'); const t = document.createTextNode(c.ch); parent.insertBefore(t, cur && parent.contains(cur) ? cur : null); }
            else if (c.type === 'br') { const cur = el.querySelector('.typewriter-cursor'); parent.insertBefore(document.createElement('br'), cur && parent.contains(cur) ? cur : null); }
            else if (c.type === 'open') { const n = c.node; const cur = el.querySelector('.typewriter-cursor'); parent.insertBefore(n, cur && parent.contains(cur) ? cur : null); stack.push(n); }
            else if (c.type === 'close') { const closed = stack.pop(); const cur = el.querySelector('.typewriter-cursor'); if (cur && closed.contains(cur)) { closed.parentNode.insertBefore(cur, closed.nextSibling); } }
            const delay = c.type === 'br' ? 200 : speed;
            setTimeout(tick, delay);
        }
        setTimeout(tick, 600);
    }

    async function loadProducts() {
        const c = document.getElementById('productsContainer'); c.innerHTML = '<div class="loading-spinner">Loading...</div>';
        const { data: dl } = await supabaseShop.from('shop_customer_downloads').select('product_id').eq('customer_id', currentCustomer.id).eq('is_active', true);
        purchasedProductIds = (dl || []).map(d => d.product_id);
        const { data: pr } = await supabaseShop.from('shop_products').select('*').eq('is_active', true);
        allProducts = pr || [];
        const isFree = p => !p.price || Number(p.price) <= 0;
        const pp = allProducts.filter(p => purchasedProductIds.includes(p.id) || isFree(p)), up = allProducts.filter(p => !purchasedProductIds.includes(p.id) && !isFree(p));
        if (pp.length === 0) { c.innerHTML = `<div class="empty-state"><div class="icon">📦</div><p>သင့်အတွက် ပစ္စည်းများ မရှိသေးပါ။<br>အောက်ဘက်မှ ၀ယ်ယူပြီးပါက ဤနေရာတွင် ပေါ်လာပါမည်။</p></div>`; }
        else { c.innerHTML = `<div class="product-grid">${pp.map(p => { const ic = p.category === 'course'; return `<div class="product-card"><div class="thumb-wrapper">${ic ? '<span class="course-card-badge"><i class="fas fa-play-circle" style="margin-right:3px;"></i>Course</span>' : ''}<img class="thumb" src="${p.thumbnail_url || ''}" alt="${p.name}" onerror="this.style.display='none'" loading="lazy" /></div><div class="card-body"><div class="product-name">${p.name}</div><span class="category-badge">${PRODUCT_CATEGORIES[p.category] || p.category}</span>${ic ? `<button onclick="openCourse('${p.id}')" class="btn-download" style="background:var(--primary-black);color:var(--accent-green);"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><polygon points="5 3 19 12 5 21 5 3"/></svg>Start Learning</button>` : `<a href="${p.download_url}" target="_blank" rel="noopener noreferrer" class="btn-download"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Download</a>`}</div></div>`; }).join('')}</div>`; }
        const bs = document.getElementById('browseSection'), bc = document.getElementById('browseContainer');
        if (up.length > 0) { bs.style.display = 'block'; bc.innerHTML = `<div class="product-grid">${up.map(p => { const ic = p.category === 'course', inC = cart.some(x => x.id === p.id); return `<div class="product-card browse-card"><div class="thumb-wrapper">${ic ? '<span class="course-card-badge"><i class="fas fa-play-circle" style="margin-right:3px;"></i>Course</span>' : ''}<img class="thumb" src="${p.thumbnail_url || ''}" alt="${p.name}" onerror="this.style.display='none'" loading="lazy" /></div><div class="card-body"><div class="product-name">${p.name}</div><span class="category-badge">${PRODUCT_CATEGORIES[p.category] || p.category}</span><div class="browse-price">${Number(p.price).toLocaleString()} <span>MMK</span></div><button onclick="addToCart('${p.id}')" class="btn-buy ${inC ? 'added' : ''}" id="buy-${p.id}"><i class="fas ${inC ? 'fa-check' : 'fa-shopping-bag'}"></i>${inC ? 'Added' : 'Buy'}</button></div></div>`; }).join('')}</div>`; }
        else { bs.style.display = 'block'; bc.innerHTML = `<div style="text-align:center;padding:50px 24px;background:var(--primary-white);border-radius:var(--radius-lg);border:1px solid rgba(0,0,0,.05);box-shadow:var(--shadow-sm);"><div style="font-size:2.8em;margin-bottom:14px;opacity:.2;">🎉</div><p style="color:#bbb;font-size:.88em;line-height:1.9;max-width:340px;margin:0 auto;">All products purchased!</p></div>`; }
        checkPendingOrders();
    }

    // ========== CART ==========
    window.addToCart = (id) => { const p = allProducts.find(x => x.id === id); if (!p || cart.some(x => x.id === id)) return; cart.push(p); updateCartUI(); const b = document.getElementById(`buy-${id}`); if (b) { b.classList.add('added'); b.innerHTML = '<i class="fas fa-check"></i> Added'; } openCart(); };
    window.removeFromCart = (id) => { cart = cart.filter(x => x.id !== id); updateCartUI(); const b = document.getElementById(`buy-${id}`); if (b) { b.classList.remove('added'); b.innerHTML = '<i class="fas fa-shopping-bag"></i> Buy'; } };
    function updateCartUI() { const ce = document.getElementById('cartCount'); if (cart.length > 0) { ce.textContent = cart.length; ce.classList.remove('hidden-count'); } else ce.classList.add('hidden-count'); const ci = document.getElementById('cartItems'); if (cart.length === 0) ci.innerHTML = `<div class="cart-empty"><i class="fas fa-shopping-bag"></i><p style="font-size:.85em;">Your cart is empty</p></div>`; else ci.innerHTML = cart.map(p => `<div class="cart-item"><img src="${p.thumbnail_url || ''}" alt="${p.name}" class="cart-item-img" onerror="this.style.background='#eee'"><div class="cart-item-info"><div class="cart-item-name">${p.name}</div><div class="cart-item-price">${Number(p.price).toLocaleString()} MMK</div></div><button onclick="removeFromCart('${p.id}')" class="cart-item-remove"><i class="fas fa-times"></i></button></div>`).join(''); const t = cart.reduce((s, p) => s + Number(p.price), 0); document.getElementById('cartTotal').textContent = t.toLocaleString() + ' MMK'; document.getElementById('orderBtn').disabled = cart.length === 0; document.getElementById('orderBtn').style.opacity = cart.length === 0 ? '.5' : '1'; }
    function openCart() { document.getElementById('cartOverlay').classList.add('active'); document.getElementById('cartSlidein').classList.add('active'); document.body.style.overflow = 'hidden'; }
    function closeCart() { document.getElementById('cartOverlay').classList.remove('active'); document.getElementById('cartSlidein').classList.remove('active'); document.body.style.overflow = ''; }
    window.toggleCart = () => { document.getElementById('cartSlidein').classList.contains('active') ? closeCart() : openCart(); };
    window.closeCart = closeCart;
    window.placeOrder = async () => { if (cart.length === 0) return; const ob = document.getElementById('orderBtn'); ob.disabled = true; ob.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right:6px;"></i>Processing...'; try { const od = cart.map(p => ({ customer_id: currentCustomer.id, product_id: p.id, amount: Number(p.price), status: 'pending' })); const { error } = await supabaseShop.from('shop_orders').insert(od); if (error) { alert('Order Error: ' + error.message); ob.disabled = false; ob.innerHTML = '<i class="fas fa-paper-plane" style="margin-right:6px;"></i>Order'; return; } cart = []; updateCartUI(); closeCart(); showToast('Order placed! Admin ကအတည်ပြုပြီးပါက ရယူနိုင်ပါမည်။'); await loadProducts(); } catch (e) { alert('Error: ' + e.message); } ob.disabled = false; ob.innerHTML = '<i class="fas fa-paper-plane" style="margin-right:6px;"></i>Order'; };
    function showToast(m) { const t = document.getElementById('toast'); document.getElementById('toastMsg').textContent = m; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 4000); }

    // ========== PENDING ORDER NOTICE ==========
    async function checkPendingOrders() {
        if (!currentCustomer) return;
        const { data } = await supabaseShop
            .from('shop_orders')
            .select('id')
            .eq('customer_id', currentCustomer.id)
            .eq('status', 'pending');
        const notice = document.getElementById('pendingNotice');
        if (data && data.length > 0) {
            notice.classList.add('show');
        } else {
            notice.classList.remove('show');
        }
    }

    // ========== PROFILE ==========
    let customerOrders = [];
    function openProfile() { renderProfile(); loadOrderHistory(); document.getElementById('profileOverlay').classList.add('active'); document.getElementById('profileSlidein').classList.add('active'); document.body.style.overflow = 'hidden'; }
    function closeProfile() { document.getElementById('profileOverlay').classList.remove('active'); document.getElementById('profileSlidein').classList.remove('active'); document.body.style.overflow = ''; }
    window.toggleProfile = () => { document.getElementById('profileSlidein').classList.contains('active') ? closeProfile() : openProfile(); };
    window.closeProfile = closeProfile;
    function renderProfile() {
        if (!currentCustomer) return; const i = getInitials(currentCustomer.name), a = currentCustomer._avatarUrl;
        const ae = document.getElementById('profileAvatar'); if (a) ae.innerHTML = `<img src="${a}" alt="">`; else ae.textContent = i;
        document.getElementById('profileName').textContent = currentCustomer.name;
        document.getElementById('profileEmail').textContent = currentCustomer.email || '-';
        document.getElementById('profilePhone').textContent = currentCustomer.phone || '-';
        document.getElementById('statProducts').textContent = purchasedProductIds.length;
        const mi = document.getElementById('loginMethodIcon'), mv = document.getElementById('loginMethodValue');
        const prov = currentCustomer.auth_provider || 'email';
        if (prov === 'google') { mi.innerHTML = '<i class="fab fa-google"></i>'; mi.style.background = '#fef2f2'; mi.style.color = '#dc2626'; mv.textContent = 'Google Account'; }
        else { mi.innerHTML = '<i class="fas fa-envelope"></i>'; mi.style.background = '#eff6ff'; mi.style.color = '#2563eb'; mv.textContent = 'Email / Password'; }
        if (currentCustomer.created_at) { const d = new Date(currentCustomer.created_at); document.getElementById('profileDate').textContent = d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); }
    }
    async function loadOrderHistory() {
        const { data: o } = await supabaseShop.from('shop_orders').select('*, shop_products(name)').eq('customer_id', currentCustomer.id).order('created_at', { ascending: false });
        customerOrders = o || []; document.getElementById('statOrders').textContent = customerOrders.length;
        const c = document.getElementById('profileOrdersList');
        if (customerOrders.length === 0) { c.innerHTML = `<div class="profile-orders-empty"><i class="fas fa-receipt"></i><p>No orders yet</p></div>`; return; }
        const si = { pending: 'fa-clock', confirmed: 'fa-check-circle', delivered: 'fa-box-open', cancelled: 'fa-times-circle' }, sl = { pending: 'Pending', confirmed: 'Confirmed', delivered: 'Delivered', cancelled: 'Cancelled' };
        c.innerHTML = customerOrders.map(o => { const s = o.status || 'pending', d = new Date(o.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }); return `<div class="profile-order-item"><div class="order-icon ${s}"><i class="fas ${si[s] || 'fa-receipt'}"></i></div><div class="order-detail"><div class="order-name">${o.shop_products?.name || 'Product'}</div><div class="order-meta">${d} · ${Number(o.amount).toLocaleString()} MMK</div></div><span class="order-status-badge ${s}">${sl[s] || s}</span></div>`; }).join('');
    }

    // ========== COURSE PLAYER ==========
    let courseLessons = [], lessonMaterialsMap = {}, currentLessonId = null, currentCourseId = null;
    window.openCourse = async (pid) => { currentCourseId = pid; document.getElementById('myProductsSection').classList.add('hidden'); document.getElementById('coursePlayerSection').classList.remove('hidden'); const { data: ls } = await supabaseShop.from('shop_course_lessons').select('*').eq('product_id', pid).order('sort_order', { ascending: true }); courseLessons = ls || []; lessonMaterialsMap = {}; if (courseLessons.length > 0) { const ids = courseLessons.map(l => l.id); const { data: ms } = await supabaseShop.from('shop_lesson_materials').select('*').in('lesson_id', ids).order('sort_order', { ascending: true }); (ms || []).forEach(m => { if (!lessonMaterialsMap[m.lesson_id]) lessonMaterialsMap[m.lesson_id] = []; lessonMaterialsMap[m.lesson_id].push(m); }); } renderLessonList(); if (courseLessons.length > 0) selectLesson(courseLessons[0].id); else { document.getElementById('lessonsList').innerHTML = '<p style="text-align:center;color:#999;padding:20px;">No lessons yet.</p>'; document.getElementById('currentLessonTitle').textContent = 'No lessons yet'; document.getElementById('currentLessonDesc').textContent = ''; document.getElementById('courseVideoPlayer').src = ''; document.getElementById('lessonMaterialsSection').style.display = 'none'; } window.scrollTo({ top: 0, behavior: 'smooth' }); };
    function renderLessonList() { const c = document.getElementById('lessonsList'); if (!courseLessons.length) { c.innerHTML = '<p style="text-align:center;color:#999;">No lessons.</p>'; return; } c.innerHTML = courseLessons.map((l, i) => { const m = lessonMaterialsMap[l.id] || []; return `<div class="lesson-list-item ${l.id === currentLessonId ? 'active' : ''}" onclick="selectLesson('${l.id}')"><span class="lesson-idx">${i + 1}</span><span class="lesson-title-text">${l.title}</span>${m.length > 0 ? `<span class="lesson-mat-badge"><i class="fas fa-paperclip" style="font-size:.7em;"></i> ${m.length}</span>` : ''}<span class="lesson-duration">${l.duration || ''}</span></div>`; }).join(''); }
    window.selectLesson = (id) => { currentLessonId = id; const l = courseLessons.find(x => x.id === id); if (!l) return; document.getElementById('courseVideoPlayer').src = l.video_url ? convertToEmbedUrl(l.video_url) : ''; document.getElementById('currentLessonTitle').textContent = l.title; document.getElementById('currentLessonDesc').textContent = l.description || ''; renderLessonMaterials(id); renderLessonList(); };
    function renderLessonMaterials(id) { const ms = lessonMaterialsMap[id] || [], s = document.getElementById('lessonMaterialsSection'); if (!ms.length) { s.style.display = 'none'; return; } s.style.display = 'block'; document.getElementById('materialCount').textContent = `${ms.length} file${ms.length !== 1 ? 's' : ''}`; document.getElementById('downloadAllBtn').style.display = ms.length > 1 ? 'flex' : 'none'; document.getElementById('materialsList').innerHTML = ms.map(m => `<div class="material-download-card"><div class="mat-icon ${m.file_type || 'other'}">${FILE_SVG}</div><div class="mat-details"><p class="mat-name">${m.title}</p><span class="mat-meta">${(m.file_type || 'file').toUpperCase()}${m.file_size ? ' · ' + m.file_size : ''}</span></div><button onclick="downloadMaterial('${m.file_url}','${m.title.replace(/'/g, "\\'")}')" class="mat-download-btn"><i class="fas fa-download" style="font-size:.8em;"></i>Download</button></div>`).join(''); }
    window.downloadMaterial = (u, t) => { const a = document.createElement('a'); a.href = u; a.target = '_blank'; a.rel = 'noopener noreferrer'; document.body.appendChild(a); a.click(); document.body.removeChild(a); };
    window.downloadAllMaterials = () => { const m = lessonMaterialsMap[currentLessonId] || []; if (!m.length || !confirm(`Download all ${m.length} files?`)) return; m.forEach((x, i) => setTimeout(() => downloadMaterial(x.file_url, x.title), i * 500)); };
    function convertToEmbedUrl(u) { if (!u) return ''; const yt = u.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&?#]+)/); if (yt) return `https://www.youtube.com/embed/${yt[1]}`; const v = u.match(/vimeo\.com\/(\d+)/); if (v) return `https://player.vimeo.com/video/${v[1]}`; if (u.includes('drive.google.com')) { const f = u.match(/\/d\/([^/]+)/); if (f) return `https://drive.google.com/file/d/${f[1]}/preview`; } return u; }
    window.backToCourses = () => { document.getElementById('coursePlayerSection').classList.add('hidden'); document.getElementById('myProductsSection').classList.remove('hidden'); window.scrollTo({ top: 0, behavior: 'smooth' }); };

    // ========== PAYMENT GUIDE MODAL ==========
    let payScreenshotFile = null;

    window.openPayGuide = () => {
        // Reset state
        payScreenshotFile = null;

        // Always restore full body HTML (handles re-open after success message)
        document.getElementById('payGuideBody').innerHTML = `
            <div class="pay-step">
                <div class="pay-step-num">1</div>
                <div class="pay-step-content">
                    <p><strong>Cart ထည့်ပါ</strong><br>ဝယ်ချင်သော product ၏ <strong>Buy</strong> ခလုတ်နှိပ်၍ Cart ထဲသို့ ထည့်ပါ၊ ထို့နောက် <strong>Order</strong> ခလုတ်နှိပ်ပါ။</p>
                </div>
            </div>
            <div class="pay-step">
                <div class="pay-step-num">2</div>
                <div class="pay-step-content">
                    <p><strong>KBZ Pay ဖြင့် ငွေပေးချေပါ</strong><br>အောက်ဖော်ပြပါ QR Code ကို KBZ Pay App မှ Scan ပြုလုပ်၍ ငွေပေးချေပါ။</p>
                    <div class="pay-qr-wrap">
                        <img src="https://res.cloudinary.com/ddkd9lxpr/image/upload/v1772078379/kbz-pay_fwm6be.jpg" alt="KBZ Pay QR" onerror="this.src='https://placehold.co/200x200?text=QR+Code'" style="width:200px;height:200px;object-fit:cover;border-radius:10px;display:block;margin:0 auto 10px;">
                        <div class="pay-kbz-info">
                            <span class="kbz-label">KBZ Pay Number</span>
                            <span class="kbz-value">09 953 681 497</span>
                            <span class="kbz-label" style="margin-top:6px;">Name</span>
                            <span class="kbz-value">Phyo Min Zaw</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pay-step">
                <div class="pay-step-num">3</div>
                <div class="pay-step-content">
                    <p><strong>Screenshot ရိုက်ပြီး Admin ထံ ပေးပို့ပါ</strong><br>ငွေပေးချေပြီးပါက KBZ Pay payment screenshot ကို ဒီမှာ Upload လုပ်ပြီး Admin ထံ ပေးပို့ပါ။</p>
                    <div class="pay-divider"></div>
                    <div class="pay-upload-area" id="payUploadArea" onclick="document.getElementById('payScreenshotFile').click()">
                        <input type="file" id="payScreenshotFile" accept="image/*" onchange="handleScreenshotSelect(event)" style="display:none">
                        <i class="fas fa-cloud-upload-alt" id="payUploadIcon"></i>
                        <p id="payUploadText">Screenshot ကို ဒီနေရာတွင် နှိပ်၍ Upload လုပ်ပါ<br><span style="font-size:.9em;opacity:.7;">JPG, PNG — Max 5MB</span></p>
                        <img id="payPreviewImg" class="pay-preview-img" alt="Preview">
                    </div>
                    <button class="pay-submit-btn grain-btn" id="paySubmitBtn" onclick="submitPaymentScreenshot()" disabled>
                        <i class="fas fa-paper-plane"></i> Admin ထံ ပေးပို့မည်
                    </button>
                </div>
            </div>
        `;

        document.getElementById('payGuideOverlay').classList.add('active');
        document.getElementById('payGuideModal').classList.add('active');
        document.body.style.overflow = 'hidden';
    };

    window.closePayGuide = () => {
        document.getElementById('payGuideOverlay').classList.remove('active');
        document.getElementById('payGuideModal').classList.remove('active');
        document.body.style.overflow = '';
    };

    window.openScreenshotUpload = () => {
        payScreenshotFile = null;
        document.getElementById('payGuideBody').innerHTML = `
            <div class="pay-upload-area" id="payUploadArea" onclick="document.getElementById('payScreenshotFile').click()">
                <input type="file" id="payScreenshotFile" accept="image/*" onchange="handleScreenshotSelect(event)" style="display:none">
                <i class="fas fa-cloud-upload-alt" id="payUploadIcon"></i>
                <p id="payUploadText">Screenshot ကို ဒီနေရာတွင် နှိပ်၍ Upload လုပ်ပါ<br><span style="font-size:.9em;opacity:.7;">JPG, PNG — Max 5MB</span></p>
                <img id="payPreviewImg" class="pay-preview-img" alt="Preview">
            </div>
            <button class="pay-submit-btn grain-btn" id="paySubmitBtn" onclick="submitPaymentScreenshot()" disabled>
                <i class="fas fa-paper-plane"></i> Admin ထံ ပေးပို့မည်
            </button>
        `;
        document.querySelector('#payGuideModal .pay-modal-header h3').innerHTML = '<i class="fas fa-image" style="color:var(--accent-green);"></i> Screenshot ပို့မည်';
        document.getElementById('payGuideOverlay').classList.add('active');
        document.getElementById('payGuideModal').classList.add('active');
        document.body.style.overflow = 'hidden';
    };

    window.handleScreenshotSelect = (event) => {
        const file = event.target.files[0];
        if (!file) return;
        if (file.size > 5 * 1024 * 1024) {
            alert('File size 5MB ထက်မကျော်ပါနှင့်!');
            return;
        }
        payScreenshotFile = file;
        const reader = new FileReader();
        reader.onload = (e) => {
            const preview = document.getElementById('payPreviewImg');
            preview.src = e.target.result;
            preview.className = 'pay-preview-img show';
            document.getElementById('payUploadIcon').className = 'fas fa-check-circle';
            document.getElementById('payUploadText').textContent = file.name;
            document.getElementById('payUploadArea').classList.add('has-file');
            document.getElementById('paySubmitBtn').disabled = false;
        };
        reader.readAsDataURL(file);
    };

    window.submitPaymentScreenshot = async () => {
        if (!payScreenshotFile || !currentCustomer) return;
        const btn = document.getElementById('paySubmitBtn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ပို့နေသည်...';

        try {
            // Convert image to base64 — no Storage bucket needed
            const base64 = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result); // data:image/...;base64,...
                reader.onerror = () => reject(new Error('File ဖတ်၍မရပါ'));
                reader.readAsDataURL(payScreenshotFile);
            });

            // Compress if > 1MB
            let finalBase64 = base64;
            if (base64.length > 1.2 * 1024 * 1024) {
                finalBase64 = await compressImage(base64, 0.7);
            }

            // Find latest pending order and attach screenshot
            const { data: pendingOrders } = await supabaseShop
                .from('shop_orders')
                .select('id')
                .eq('customer_id', currentCustomer.id)
                .eq('status', 'pending')
                .order('created_at', { ascending: false })
                .limit(1);

            if (pendingOrders && pendingOrders.length > 0) {
                const { error } = await supabaseShop
                    .from('shop_orders')
                    .update({ payment_screenshot_url: finalBase64 })
                    .eq('id', pendingOrders[0].id);
                if (error) throw new Error(error.message);
            } else {
                // No pending order — ask customer to place order first
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> Admin ထံ ပေးပို့မည်';
                document.getElementById('payGuideBody').innerHTML = `
                    <div class="pay-success-box">
                        <span class="success-emoji">⚠️</span>
                        <h4>Order ဦးစွာ တင်ပါ</h4>
                        <p>Screenshot မပို့မီ ဝယ်ယူလိုသော Product ၏ <strong>Buy → Order</strong> ကို ဦးစွာ နှိပ်ပြီး Order တင်ပါ။<br><br>Order တင်ပြီးမှ ဒီနေရာမှ Screenshot ပြန်ပို့ပါ။</p>
                        <button onclick="closePayGuide()" style="margin-top:18px;padding:10px 28px;border-radius:50px;background:var(--primary-black);color:var(--accent-green);border:none;font-weight:700;font-family:'Poppins',sans-serif;cursor:pointer;font-size:.88em;"><i class="fas fa-arrow-left" style="margin-right:6px;"></i>ပြန်သွားမည်</button>
                    </div>
                `;
                return;
            }

            // Show success
            document.getElementById('pendingNotice').classList.remove('show');
            document.getElementById('payGuideBody').innerHTML = `
                <div class="pay-success-box">
                    <span class="success-emoji">🎉</span>
                    <h4>ပေးပို့ပြီးပါပြီ!</h4>
                    <p>Payment screenshot ကို Admin ထံ သို့ ပေးပို့ပြီးပါပြီ။<br>Admin က အတည်ပြုပြီးသည့်နောက် Product ကို ရယူနိုင်ပါမည်။</p>
                    <button onclick="closePayGuide()" style="margin-top:18px;padding:10px 28px;border-radius:50px;background:var(--primary-black);color:var(--accent-green);border:none;font-weight:700;font-family:'Poppins',sans-serif;cursor:pointer;font-size:.88em;">ပိတ်မည်</button>
                </div>
            `;
            showToast('Screenshot ပေးပို့ပြီးပါပြီ! Admin ကအတည်ပြုပါမည်။');

        } catch (e) {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-paper-plane"></i> Admin ထံ ပေးပို့မည်';
            alert('Error: ' + e.message);
        }
    };

    // Compress image helper
    function compressImage(base64, quality) {
        return new Promise((resolve) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                let w = img.width, h = img.height;
                const MAX = 1200;
                if (w > MAX || h > MAX) {
                    if (w > h) { h = Math.round(h * MAX / w); w = MAX; }
                    else { w = Math.round(w * MAX / h); h = MAX; }
                }
                canvas.width = w; canvas.height = h;
                canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                resolve(canvas.toDataURL('image/jpeg', quality));
            };
            img.src = base64;
        });
    }

    </script>
</body>
</html>